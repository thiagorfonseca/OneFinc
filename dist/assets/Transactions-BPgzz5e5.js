import{c as Ma,b as ut,d as mt,u as pt,r as p,R as xt,j as e,C as qa,s as _}from"./index-D0iWI1-0.js";import{f as P,b as ne}from"./utils-C6qNh0Lg.js";import{P as Sa}from"./plus-XBhS4Bhv.js";import{S as gt}from"./search-hjlihMJX.js";import{F as Pa}from"./filter-LHQUDt38.js";import{L as Ia}from"./loader-2-FHfyU3Jl.js";import{D as Ea}from"./download-Dp9jONEZ.js";import{T as ht}from"./trash-2-Cqpa7ac5.js";import{A as Ta}from"./alert-triangle-DXnY-puH.js";import{A as bt}from"./alert-circle-B_eEHIv1.js";const ft=Ma("CalendarCheck",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]),yt=Ma("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]),Fa=["Cartão de Crédito","Cartão de Débito","PIX","Boleto","Dinheiro","Transferência Bancária","Cheque"],Aa=[{value:"C. Credito",label:"C. Credito"},{value:"C. Debito",label:"C. Debito"},{value:"PIX",label:"Pix"},{value:"Boleto",label:"Boleto"},{value:"Dinheiro",label:"Dinheiro"},{value:"Cheque",label:"Cheque"},{value:"Permuta",label:"Permuta"},{value:"Outros",label:"Outros"}],Oa={"Cartão de Crédito":"2.99","Cartão de Débito":"1.50",PIX:"0.50",Boleto:"0",Dinheiro:"0","Transferência Bancária":"0",Cheque:"0"},Ge=(D,n)=>{const N=new Date(D);return N.setDate(N.getDate()+n),N.toISOString().split("T")[0]},re=(D,n)=>{const N=new Date(D);return N.setMonth(N.getMonth()+n),N.toISOString().split("T")[0]},_t=(D,n)=>{const N=new Date(D);let K=0;for(;K<n;){N.setDate(N.getDate()+1);const ue=N.getDay();ue!==0&&ue!==6&&K++}return N.toISOString().split("T")[0]},vt=D=>{if(!D)return"PIX";const n=D.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase();return n.includes("CREDITO")?"C. Credito":n.includes("DEBITO")?"C. Debito":n.includes("PIX")?"PIX":n.includes("BOLETO")?"Boleto":n.includes("DINHEIRO")||n.includes("CASH")?"Dinheiro":n.includes("CHEQUE")?"Cheque":n.includes("PERMUTA")?"Permuta":(n.includes("OUTRO"),"Outros")},J=D=>Number(D?.valor_bruto??D?.valor??D?.valor_liquido??0)||0,Et=({type:D})=>{const n=D==="income",N=n?"revenues":"expenses",K=ut(),ue=mt(),{effectiveClinicId:Ba}=pt(),I=Ba||null,[Ra,Je]=p.useState(!0),[Ke,We]=p.useState([]),[me,Ze]=p.useState([]),[oe,ea]=p.useState([]),[Me,aa]=p.useState([]),[Va,ta]=p.useState([]),[W,sa]=p.useState([]),[T,pe]=p.useState([]),[xe,na]=p.useState(""),[ra,oa]=p.useState("1"),[la,ia]=p.useState([]),[Ne,we]=p.useState({venda:"",execucao:""}),[Ce,X]=p.useState([]),[ca,Z]=p.useState(!1),[da,ua]=p.useState([]),[ma,Be]=p.useState(""),[pa,xa]=p.useState([]),[V,Re]=p.useState({tipoDespesa:"",pessoaTipo:"",status:""}),[H,le]=p.useState("data_competencia"),[q,ie]=p.useState("desc"),[De,za]=p.useState(50),[ge,ke]=p.useState(1),[E,Q]=p.useState([]),[F,he]=p.useState({bank_account_id:"",category_id:"",forma_pagamento:"",data_competencia:""}),[qe,$a]=p.useState("competencia"),[be,La]=p.useState(""),[ee,Ua]=p.useState(()=>{const a=new Date;return new Date(a.getFullYear(),a.getMonth(),1).toISOString().split("T")[0]}),[fe,Xa]=p.useState(()=>{const a=new Date;return new Date(a.getFullYear(),a.getMonth()+1,0).toISOString().split("T")[0]}),[Ha,Se]=p.useState(!1),[Y,Ve]=p.useState(null),[ga,ha]=p.useState(!1),[Qa,Pe]=p.useState(!1),[ze,ba]=p.useState(!1),[fa,ye]=p.useState(!1),[z,Ie]=p.useState(null),[ae,Ee]=p.useState(null),[Ya,$e]=p.useState(!1),[L,Le]=p.useState(null),[Ue,Te]=p.useState(""),[ya,Xe]=p.useState(!1),_a={description:"",gross_amount:"",discount:"",tax_rate:Oa.PIX,tax_amount:"0",liquid_amount:"",date:new Date().toISOString().split("T")[0],due_date:new Date().toISOString().split("T")[0],category_id:"",bank_account_id:"",entity_name:"",payment_method:"PIX",observations:"",installments:"1",nsu:"",boleto_due_date:"",cheque_number:"",cheque_bank:"",cheque_due_date:"",cheque_pages:"1",cheque_value:"",is_recurring:!1,recurrence_interval:"mensal",recurrence_count:"1",card_brand:"",tipo_despesa:"",status:"pending",pessoa_tipo:"",is_installment:!1},[t,S]=p.useState(_a),G=async()=>{We([]),Je(!0);try{if(!I){ea([]),Ze([]),aa([]),ta([]),sa([]),ia([]),ua([]),xa([]);return}const{data:{session:a}}=await _.auth.getSession();if(!a)return;const{data:s}=await _.from("categories").select("*").eq("tipo",n?"receita":"despesa");let r=_.from("bank_accounts").select("*");I&&(r=r.eq("clinic_id",I));const{data:l}=await r,{data:u}=await _.from("card_fees").select("*"),{data:c}=await _.from("customers").select("*"),{data:m}=await _.from("procedures").select("*"),{data:x}=await _.from("professionals").select("*"),{data:j}=await _.from("suppliers").select("*"),{data:k}=await _.from("revenues").select("id, data_competencia, paciente");if(s&&Ze(s),l){const g=await Ga(l);ea(g)}u&&aa(u),c&&ta(c),m&&sa(m),x&&ia(x),j&&ua(j),k&&xa(k);let v;n?v=_.from(N).select(`
            *,
            categories (name, cor_opcional),
            bank_accounts (nome_conta),
            revenue_procedures (procedimento, categoria, quantidade, valor_cobrado, procedure_id)
          `).order("data_competencia",{ascending:!1}):v=_.from(N).select(`
            *,
            categories (name, cor_opcional),
            bank_accounts (nome_conta)
          `).order("data_competencia",{ascending:!1}),I&&(v=v.eq("clinic_id",I));const A=!n&&qe==="vencimento"?"data_vencimento":"data_competencia";ee&&(v=v.gte(A,ee)),fe&&(v=v.lte(A,fe));const{data:w,error:U}=await v;if(U)throw U;We(w||[])}catch(a){console.error("Erro ao buscar dados:",a)}finally{Je(!1)}};p.useEffect(()=>{G()},[D,ee,fe,qe,I]),p.useEffect(()=>{const a=x=>{const j=(x||"").replace(",","."),k=parseFloat(j);return isNaN(k)?0:k},s=a(t.gross_amount),r=a(t.discount),l=Math.max(0,s-r),u=a(t.tax_rate);if(!t.gross_amount&&!T.length){S(x=>({...x,tax_amount:"0",liquid_amount:""}));return}const c=l*(u/100),m=l-c;S(x=>({...x,tax_amount:c.toFixed(2),liquid_amount:m.toFixed(2)}))},[t.gross_amount,t.tax_rate]),p.useEffect(()=>{if(t.payment_method==="Cartão de Crédito"||t.payment_method==="Cartão de Débito"){const s=parseInt(t.installments||"1",10)||1,r=Me.find(l=>(!t.card_brand||l.bandeira===t.card_brand)&&s>=(l.min_installments||1)&&s<=(l.max_installments||1));if(r){S(l=>({...l,tax_rate:String(r.taxa_percent||"0"),card_brand:r.bandeira}));return}}const a=Oa[t.payment_method]??t.tax_rate;S(s=>({...s,tax_rate:a}))},[t.payment_method,t.installments,t.card_brand,Me]),p.useEffect(()=>{if(!n||!T.length)return;const a=T.reduce((s,r)=>{const l=W.find(c=>c.id===r.id),u=l?.valor_cobrado?Number(l.valor_cobrado):0;return s+u*(r.quantidade||1)},0);S(s=>({...s,gross_amount:a.toFixed(2)}))},[T,W,n]);const f=a=>{const{name:s,value:r,type:l,checked:u}=a.target;if(l==="checkbox"){if(s==="is_recurring"){S(c=>({...c,is_recurring:u,is_installment:u?!1:c.is_installment}));return}if(s==="is_installment"){S(c=>({...c,is_installment:u,is_recurring:u?!1:c.is_recurring,...u?{}:{installments:"1"}}));return}S(c=>({...c,[s]:u}));return}s==="due_date"&&Xe(!0),S(c=>({...c,[s]:r}))};p.useEffect(()=>{if(n){S(s=>s.due_date===s.date?s:{...s,due_date:s.date});return}if(ya)return;const a=t.payment_method==="Cartão de Crédito"?Ge(t.date,30):t.date;S(s=>s.due_date===a?s:{...s,due_date:a})},[t.payment_method,t.date,n,ya]);const va=a=>{if(!a)return[];try{const s=Array.isArray(a)?a:typeof a=="string"?JSON.parse(a):[];return Array.isArray(s)?s.map(r=>typeof r=="string"?{vencimento:r}:!r||typeof r!="object"?null:{vencimento:r.vencimento||r.due_date||r.data||r.date||"",numero_folha:r.numero_folha||r.folha||r.numero||""}).filter(Boolean):[]}catch{return[]}},ja=()=>{const a=Ce.map(s=>s.vencimento).filter(Boolean);if((t.payment_method==="Boleto"||t.payment_method==="Cheque")&&a.length)return a[0];switch(t.payment_method){case"Cartão de Crédito":return Ge(t.date,30);case"Cartão de Débito":return _t(t.date,1);case"PIX":case"Dinheiro":case"Transferência Bancária":return t.date;case"Boleto":return t.boleto_due_date||t.date;case"Cheque":return t.cheque_due_date||t.date;default:return t.date}};p.useEffect(()=>{if(!n)return;const a=t.payment_method;if(a!=="Boleto"&&a!=="Cheque"){X([]),Z(!1);return}const s=a==="Cheque"?Math.max(1,parseInt(t.cheque_pages||"1",10)||1):Math.max(1,parseInt(t.installments||"1",10)||1);if(s<=1){X([]),Z(!1);return}const r=a==="Cheque"?t.cheque_due_date||t.date:t.boleto_due_date||t.date;X(l=>{if(!ca||l.length===0)return Array.from({length:s}).map((m,x)=>({vencimento:r?x===0?r:re(r,x):"",...a==="Cheque"?{numero_folha:""}:{}}));const c=[...l];for(let m=0;m<s;m+=1)c[m]?(c[m].vencimento||(c[m].vencimento=r?m===0?r:re(r,m):""),a==="Cheque"&&c[m].numero_folha===void 0&&(c[m].numero_folha="")):c[m]={vencimento:r?m===0?r:re(r,m):"",...a==="Cheque"?{numero_folha:""}:{}};return c.slice(0,s)})},[t.payment_method,t.installments,t.boleto_due_date,t.cheque_due_date,t.cheque_pages,t.date,n,ca]);const He=a=>{if(typeof a=="string"){const r=Number(a.replace(",","."));return isNaN(r)?0:r}const s=Number(a||0);return isNaN(s)?0:s},ce=async(a,s)=>{if(!a)return;const r=oe.find(c=>c.id===a);if(!r)return;const u=He(r.current_balance??r.initial_balance??0)+s;await _.from("bank_accounts").update({current_balance:u}).eq("id",a)},_e=(a,s)=>s==="income"?!1:a==="paid",Ga=async a=>{if(!I||a.length===0)return a;const[s,r]=await Promise.all([_.from("revenues").select("bank_account_id, valor_liquido, valor_bruto, valor, status, data_competencia, data_recebimento, parcelas, forma_pagamento, recebimento_parcelas").eq("clinic_id",I),_.from("expenses").select("bank_account_id, valor, status").eq("clinic_id",I).eq("status","paid")]),l=s.data||[],u=r.data||[],c=i=>{if(!i)return null;const o=new Date(i);if(!Number.isNaN(o.getTime()))return o;const d=new Date(`${i}T00:00:00`);return Number.isNaN(d.getTime())?null:d},m=(i,o)=>{const d=new Date(i);return d.setDate(d.getDate()+o),d},x=(i,o)=>{const d=new Date(i);let y=0;for(;y<o;){d.setDate(d.getDate()+1);const b=d.getDay();b!==0&&b!==6&&(y+=1)}return d},j=(i,o)=>{const d=new Date(i);return d.setMonth(d.getMonth()+o),d},k=i=>{const o=(i||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase();return o.includes("CREDITO")?"CREDITO":o.includes("DEBITO")?"DEBITO":o.includes("PIX")?"PIX":o.includes("BOLETO")?"BOLETO":o.includes("CHEQUE")?"CHEQUE":o.includes("TRANSFER")||o.includes("TED")||o.includes("DOC")?"TRANSFERENCIA":o.includes("CONVENIO")?"CONVENIO":o.includes("DINHEIRO")||o.includes("CASH")?"DINHEIRO":"OUTRO"},v=(i,o)=>{const d=Math.floor(i/o*100)/100,y=Array(o).fill(d),b=d*o,C=Math.round((i-b)*100)/100;return y[y.length-1]=Math.round((y[y.length-1]+C)*100)/100,y},A=new Date;A.setHours(0,0,0,0);const w=i=>{const o=Number(i.valor_liquido??i.valor_bruto??i.valor??0);if(!Number.isFinite(o)||o===0)return 0;const d=va(i.recebimento_parcelas).map(R=>c(R.vencimento)).filter(Boolean),y=Math.max(1,d.length||parseInt(i.parcelas||"1",10)||1),b=k(i.forma_pagamento),C=c(i.data_recebimento),$=c(i.data_competencia);let B=null;if(b==="BOLETO"||b==="CHEQUE"?B=C||$:b==="CREDITO"||b==="CONVENIO"?B=C||($?m($,30):null):b==="DEBITO"?B=C||($?x($,1):null):B=C||$,!B&&d.length===0)return 0;const je=b==="CREDITO"||b==="CONVENIO"?30:0,dt=v(o,y);let ka=0;for(let R=0;R<y;R+=1){let Oe=d[R]||B;Oe&&(d[R]||(je&&R>0?Oe=m(B,je*R):!je&&y>1&&R>0&&(Oe=j(B,R))),Oe<=A&&(ka+=dt[R]||0))}return ka},U=new Map;l.forEach(i=>{if(!i.bank_account_id)return;const o=w(i);!Number.isFinite(o)||o===0||U.set(i.bank_account_id,(U.get(i.bank_account_id)||0)+o)});const g=new Map;u.forEach(i=>{if(!i.bank_account_id)return;const o=Number(i.valor??0);Number.isFinite(o)&&g.set(i.bank_account_id,(g.get(i.bank_account_id)||0)+o)});const M=[],h=a.map(i=>{const o=He(i.initial_balance??0),d=U.get(i.id)||0,y=g.get(i.id)||0,b=o+d-y,C=He(i.current_balance??i.initial_balance??0);return Math.abs(C-b)>.009&&M.push({id:i.id,current_balance:b}),{...i,current_balance:b}});return M.length&&await Promise.all(M.map(i=>_.from("bank_accounts").update({current_balance:i.current_balance}).eq("id",i.id))),h},Ja=async a=>{if(a.preventDefault(),ye(!0),!I){alert("Nenhuma clínica ativa definida. Selecione uma clínica para lançar."),ye(!1);return}try{const s=h=>{const i=(h||"").replace(",","."),o=parseFloat(i);return isNaN(o)?0:o},r=s(t.gross_amount),l=s(t.discount),u=s(t.tax_amount),c=Math.max(0,r-l),m=t.liquid_amount?s(t.liquid_amount):c,x=n&&t.payment_method==="Boleto",j=n&&t.payment_method==="Cheque",k=j?Math.max(1,parseInt(t.cheque_pages||"1",10)||1):Math.max(1,parseInt(t.installments||"1",10)||1),v=(x||j)&&k>1?Ce.slice(0,k):[];if(n&&(t.payment_method==="Cartão de Crédito"||t.payment_method==="Cartão de Débito")&&!t.nsu.trim()){alert("Informe o NSU para pagamentos em cartão de crédito ou débito."),ye(!1);return}if((x||j)&&k>1&&(v.length!==k||v.some(i=>!i.vencimento))){alert("Informe o vencimento de todas as parcelas."),ye(!1);return}const A=v.length?v[0].vencimento:ja(),w=[];n&&(w.push(`Taxa aplicada: ${t.tax_rate}% (R$ ${u.toFixed(2)})`),w.push(`Liquidação prevista: ${A}`)),t.payment_method.includes("Cartão")&&t.nsu&&w.push(`NSU: ${t.nsu}`),t.payment_method==="Cartão de Crédito"&&t.installments&&w.push(`Parcelas: ${t.installments}`),t.payment_method==="Boleto"&&(t.installments&&w.push(`Parcelas boleto: ${t.installments}`),t.boleto_due_date&&w.push(`Vencimento boleto: ${t.boleto_due_date}`),v.length>1&&w.push("Vencimentos boleto definidos manualmente")),t.payment_method==="Cheque"&&(t.cheque_number&&w.push(`Cheque nº ${t.cheque_number}`),t.cheque_bank&&w.push(`Banco cheque: ${t.cheque_bank}`),t.cheque_due_date&&w.push(`Vencimento cheque: ${t.cheque_due_date}`),t.cheque_pages&&w.push(`Folhas: ${t.cheque_pages}`),t.cheque_value&&w.push(`Valor/f.: R$ ${t.cheque_value}`),v.length>1&&w.push("Vencimentos de cheques definidos manualmente")),t.observations&&w.push(t.observations);const g={description:n?t.entity_name||(T[0]?W.find(h=>h.id===T[0].id)?.procedimento:"")||"Receita":t.description||"Despesa",data_competencia:t.date,category_id:n?null:t.category_id,bank_account_id:t.bank_account_id,observacoes:["Inserido via Web",...w].filter(Boolean).join(" | "),clinic_id:I};if(n)g.valor_bruto=r,g.valor_liquido=m,g.valor=m,g.data_recebimento=A,g.paciente=t.entity_name,g.forma_pagamento=t.payment_method,g.parcelas=k,g.forma_pagamento_taxa=t.tax_rate,g.bandeira=t.card_brand||null,g.recebimento_parcelas=v.length?v.map((h,i)=>({parcela:i+1,vencimento:h.vencimento,numero_folha:h.numero_folha?h.numero_folha:null})):null,x&&(g.boleto_due_date=t.boleto_due_date||A||null),j&&(g.cheque_number=t.cheque_number||null,g.cheque_bank=t.cheque_bank||null,g.cheque_due_date=t.cheque_due_date||A||null,g.cheque_pages=k,g.cheque_value=t.cheque_value?s(t.cheque_value):null),l>0&&w.push(`Desconto aplicado: R$ ${l.toFixed(2)}`),g.sale_professional_id=Ne.venda||null,g.exec_professional_id=Ne.execucao||null;else{g.valor=r;const h=t.due_date||t.date;g.data_vencimento=h;const i=ae?.data_pagamento||null;g.data_pagamento=t.status==="paid"?i||h:null,g.fornecedor=t.entity_name,g.supplier_id=ma||null,g.tipo_despesa=t.tipo_despesa||"variavel",g.parcelas=t.is_installment?t.installments:"1",g.forma_pagamento=t.payment_method,g.pessoa_tipo=t.pessoa_tipo||null,g.status=t.status||"pending"}let M=null;if(z){const{error:h}=await _.from(N).update(g).eq("id",z);if(h)throw h;M=z}else if(!n&&t.is_recurring){const h=Math.max(1,parseInt(t.recurrence_count||"1",10)),i=t.recurrence_interval,o=(b,C)=>C===0?b:i==="quinzenal"?Ge(b,15*C):i==="mensal"?re(b,C):i==="trimestral"?re(b,3*C):i==="anual"?re(b,12*C):b,d=Array.from({length:h}).map((b,C)=>({...g,data_vencimento:o(t.due_date||t.date,C),data_pagamento:t.status==="paid"?o(t.due_date||t.date,C):null,data_competencia:o(t.date,C),clinic_id:I})),{error:y}=await _.from(N).insert(d);if(y)throw y}else if(!n&&t.is_installment&&parseInt(t.installments||"1",10)>1){const h=Math.max(1,parseInt(t.installments||"1",10)),i=t.due_date||t.date,o=r,d=Math.floor(o*100/h),y=Array.from({length:h}).map((C,$)=>{const B=$===0?i:re(i,$),je=$===h-1?Math.round(o*100-d*(h-1)):d;return{...g,clinic_id:I,valor:je/100,data_vencimento:B,data_pagamento:t.status==="paid"?B:null,data_competencia:t.date,parcelas:1}}),{error:b}=await _.from(N).insert(y);if(b)throw b}else{const{data:h,error:i}=await _.from(N).insert([g]).select("id").maybeSingle();if(i)throw i;M=h?.id||null}if(n&&(z||M)&&T.length){const h=z||M;if(!h)return;await _.from("revenue_procedures").delete().eq("revenue_id",h);const i=T.map(o=>{const d=W.find(y=>y.id===o.id);return{revenue_id:h,procedure_id:o.id,categoria:d?.categoria||null,procedimento:d?.procedimento||null,valor_cobrado:d?.valor_cobrado||null,quantidade:o.quantidade||1}});if(i.length){const{error:o}=await _.from("revenue_procedures").insert(i);if(o)throw o}}else n&&z&&!T.length&&await _.from("revenue_procedures").delete().eq("revenue_id",z);if(z&&ae){const h=ae.bank_account_id,i=Number(n?ae.valor_liquido??ae.valor??0:ae.valor??0);if(_e(ae.status,n?"income":"expense")){const b=n?i:-i;await ce(h,-b)}const d=n?m:r;if(_e(t.status,n?"income":"expense")){const b=n?d:-d;await ce(t.bank_account_id,b)}}else{const h=n?m:r;if(_e(t.status,n?"income":"expense")){let o=n?h:-h;if(!n&&t.is_recurring){const d=Math.max(1,parseInt(t.recurrence_count||"1",10));o=o*d}await ce(t.bank_account_id,o)}}Se(!1),Ie(null),Ee(null),Ae(),G()}catch(s){alert("Erro ao salvar: "+s.message)}finally{ye(!1)}},Ka=async()=>{if(Y){ha(!0);try{const{error:a}=await _.from(N).delete().eq("id",Y.id);if(a)throw a;if(Y.shouldAffect){const s=n?-Y.amount:Y.amount;await ce(Y.accountId,s)}G()}catch(a){console.error(a)}finally{ha(!1),Ve(null)}}},Wa=a=>{Ie(a.id),Ee(a);const s=n?a.valor_bruto||a.valor||a.valor_liquido||0:a.valor||0,r=n&&a.valor_liquido||s,l=n&&s?((s-r)/s*100).toFixed(2):"0",u=(a.forma_pagamento||"").toLowerCase().includes("boleto"),c=(a.forma_pagamento||"").toLowerCase().includes("cheque"),m=va(a.recebimento_parcelas),x=a.data_competencia||new Date().toISOString().split("T")[0],j=a.data_vencimento||a.data_pagamento||a.data_recebimento||a.data_competencia||new Date().toISOString().split("T")[0];S({description:a.description||"",gross_amount:String(s),discount:"",tax_rate:String(l),tax_amount:n&&s?(s-r).toFixed(2):"0",liquid_amount:n?String(r):"",date:x,due_date:j,category_id:a.category_id||"",bank_account_id:a.bank_account_id||"",entity_name:n?a.paciente||"":a.fornecedor||"",payment_method:n?a.forma_pagamento||"PIX":vt(a.forma_pagamento),observations:a.observacoes||"",installments:a.parcelas?String(a.parcelas):"1",nsu:a.nsu||"",boleto_due_date:a.boleto_due_date||a.boleto_vencimento||(u?a.data_recebimento:"")||"",cheque_number:a.cheque_number||"",cheque_bank:a.cheque_bank||"",cheque_due_date:a.cheque_due_date||(c?a.data_recebimento:"")||"",cheque_pages:a.cheque_pages?String(a.cheque_pages):a.parcelas?String(a.parcelas):"1",cheque_value:a.cheque_value?String(a.cheque_value):"",is_recurring:!1,recurrence_interval:"mensal",recurrence_count:"1",card_brand:a.bandeira||"",tipo_despesa:a.tipo_despesa||"",status:a.status||"pending",pessoa_tipo:a.pessoa_tipo||"",is_installment:n?!1:(a.parcelas||1)>1}),Xe(!n&&j!==x),X(m),Z(m.length>0),pe([]),we({venda:"",execucao:""}),Be(a.supplier_id||""),Se(!0)},de=Ke.filter(a=>!(!((a.description||"").toLowerCase().includes(be.toLowerCase())||(a.paciente||"").toLowerCase().includes(be.toLowerCase())||(a.fornecedor||"").toLowerCase().includes(be.toLowerCase()))||!n&&(V.tipoDespesa&&(a.tipo_despesa||"")!==V.tipoDespesa||V.pessoaTipo&&(a.pessoa_tipo||"")!==V.pessoaTipo||V.status&&(a.status||"")!==V.status))),ve=[...de].sort((a,s)=>{const r=q==="asc"?1:-1,l=m=>{switch(H){case"description":return(m.description||"").toLowerCase();case"paciente":return(m.paciente||m.fornecedor||"").toLowerCase();case"data_competencia":return m.data_competencia||"";case"data_vencimento":return m.data_vencimento||m.data_pagamento||"";case"categoria":return m.categories?.name||m.revenue_procedures?.[0]?.categoria||"";case"valor":return Number(n?J(m):m.valor);default:return""}},u=l(a),c=l(s);return u<c?-1*r:u>c?1*r:0});p.useEffect(()=>{ke(1),Q([])},[H,q,be,V,ee,fe,qe,D]);const Qe=Math.max(1,Math.ceil(ve.length/De)),Fe=ve.slice((ge-1)*De,ge*De),te=ve.map(a=>a.id),Na=te.length>0&&te.every(a=>E.includes(a)),Za=()=>{if(!xe)return;const a=Math.max(1,parseInt(ra||"1",10));pe(s=>s.find(l=>l.id===xe)?s.map(l=>l.id===xe?{...l,quantidade:l.quantidade+a}:l):[...s,{id:xe,quantidade:a}]),na(""),oa("1")},et=T.reduce((a,s)=>{const r=W.find(u=>u.id===s.id),l=r?.valor_cobrado?Number(r.valor_cobrado):0;return a+l*(s.quantidade||1)},0),wa=a=>{const s=Number(a||0);return Number.isFinite(s)?s.toFixed(2).replace(".",","):"0"},Ca=a=>{if(a==null)return"";const s=String(a);return/[";\n]/.test(s)?`"${s.replace(/"/g,'""')}"`:s},Da=a=>{const s=n?["Descrição","Paciente","Data","Categoria","Forma pag.","Valor faturado"]:["Descrição","Fornecedor","Data","Vencimento","Categoria","Status","Valor"],r=ve.map(l=>n?[l.description||"",l.paciente||"-",ne(l.data_competencia),l.categories?.name||l.revenue_procedures?.[0]?.categoria||"Geral",l.forma_pagamento||"-",wa(J(l))]:[l.description||"",l.fornecedor||"-",ne(l.data_competencia),ne(l.data_vencimento||l.data_pagamento),l.categories?.name||l.revenue_procedures?.[0]?.categoria||"Geral",l.status==="paid"?"Pago":"À pagar",wa(l.valor)]);if(a==="csv"){const u=`\uFEFF${[s.map(Ca).join(";"),...r.map(j=>j.map(Ca).join(";"))].join(`
`)}`,c=new Blob([u],{type:"text/csv;charset=utf-8;"}),m=URL.createObjectURL(c),x=document.createElement("a");x.href=m,x.setAttribute("download",`${n?"receitas":"despesas"}-filtrado.csv`),document.body.appendChild(x),x.click(),document.body.removeChild(x);return}if(a==="pdf"){const l=r.map(c=>`<tr>${c.map(m=>`<td style="padding:6px;border:1px solid #ddd;font-size:12px;">${m}</td>`).join("")}</tr>`).join(""),u=window.open("","_blank");if(!u)return;u.document.write(`
        <html><head><title>${n?"Receitas":"Despesas"}</title>
        <style>table{border-collapse:collapse;width:100%;font-family:Arial;}th,td{border:1px solid #ddd;padding:6px;font-size:12px;}th{background:#f3f4f6;text-align:left;}</style>
        </head><body>
        <h3>${n?"Receitas":"Despesas"} (filtrado)</h3>
        <table>
          <thead><tr>${s.map(c=>`<th>${c}</th>`).join("")}</tr></thead>
          <tbody>${l}</tbody>
        </table>
        </body></html>
      `),u.document.close(),u.print()}},at=a=>{Q(s=>s.includes(a)?s.filter(r=>r!==a):[...s,a])},tt=()=>{const a=Fe.map(r=>r.id),s=a.every(r=>E.includes(r));Q(s?r=>r.filter(l=>!a.includes(l)):r=>Array.from(new Set([...r,...a])))},st=()=>{if(te.length!==0){if(Na){Q(a=>a.filter(s=>!te.includes(s)));return}Q(a=>Array.from(new Set([...a,...te])))}},nt=async()=>{if(E.length===0){alert("Selecione ao menos um registro.");return}const a={};if(F.bank_account_id&&(a.bank_account_id=F.bank_account_id),F.category_id&&(a.category_id=F.category_id),F.forma_pagamento&&(a.forma_pagamento=F.forma_pagamento),F.data_competencia&&(a.data_competencia=F.data_competencia),Object.keys(a).length===0){alert("Escolha pelo menos um campo para atualizar.");return}try{const{error:s}=await _.from(N).update(a).in("id",E);if(s)throw s;Q([]),he({bank_account_id:"",category_id:"",forma_pagamento:"",data_competencia:""}),G()}catch(s){alert("Erro ao atualizar em massa: "+s.message)}},rt=async()=>{if(E.length===0){alert("Selecione ao menos um registro.");return}Pe(!0)},ot=async()=>{if(E.length===0){Pe(!1);return}ba(!0);try{for(const a of E){const s=Ke.find(c=>c.id===a);if(!s)continue;const r=Number(n?s.valor_liquido||0:s.valor||0),l=s.bank_account_id,{error:u}=await _.from(N).delete().eq("id",a);if(u)throw u;if(_e(s.status,n?"income":"expense")){const c=n?-r:r;await ce(l,c)}}Pe(!1),Q([]),G()}catch(a){alert("Erro ao excluir em massa: "+a.message)}finally{ba(!1)}},lt=ja(),it=Math.max(1,parseInt(t.installments||"1",10)||1),ct=Math.max(1,parseInt(t.cheque_pages||"1",10)||1),O=p.useMemo(()=>{if(!n)return null;const a=o=>Number(o||0),s=de,r=s.reduce((o,d)=>o+a(J(d)),0),l=s.filter(o=>(o.forma_pagamento||"").toLowerCase().includes("crédito")||(o.forma_pagamento||"").toLowerCase().includes("credito")).reduce((o,d)=>o+a(J(d)),0),u=s.filter(o=>(o.forma_pagamento||"").toLowerCase().includes("débito")||(o.forma_pagamento||"").toLowerCase().includes("debito")).reduce((o,d)=>o+a(J(d)),0),c=s.filter(o=>(o.forma_pagamento||"").toLowerCase().includes("pix")).reduce((o,d)=>o+a(J(d)),0),m=s.filter(o=>(o.forma_pagamento||"").toLowerCase().includes("dinheiro")).reduce((o,d)=>o+a(J(d)),0),x=Array.from(new Set(s.map(o=>(o.paciente||"").trim()).filter(Boolean))),j=x.length?r/x.length:0,k=s.reduce((o,d)=>{const y=d.revenue_procedures||[];return y.length?o+y.reduce((b,C)=>b+(C.quantidade||0),0):o},0),v=x.length,A=ee||new Date().toISOString().split("T")[0],U=new Date(A).getFullYear()-1,M=x.filter(o=>pa.some(d=>d.paciente?(d.data_competencia?new Date(d.data_competencia).getFullYear():0)<=U&&d.paciente===o:!1)).length,h=v?M/v*100:0,i=Math.max(0,v-M);return{totalReceita:r,totalCredito:l,totalDebito:u,totalPix:c,ticketMedio:j,procedimentosRealizados:k,clientesAtendidos:v,recorrenciaPercent:h,novosClientes:i,totalDinheiro:m}},[de,n,pa,ee]),se=p.useMemo(()=>{if(n)return null;const a=de,s=a.reduce((x,j)=>x+Number(j.valor||0),0),r=a.length,l=a.filter(x=>x.tipo_despesa==="fixo").reduce((x,j)=>x+Number(j.valor||0),0),u=a.filter(x=>x.tipo_despesa==="variavel").reduce((x,j)=>x+Number(j.valor||0),0),c=s?l/s*100:0,m=s?u/s*100:0;return{total:s,quantidade:r,totalFixo:l,totalVar:u,pctFixo:c,pctVar:m}},[de,n]),Ae=()=>{S(_a),Xe(!1),pe([]),we({venda:"",execucao:""}),Be(""),X([]),Z(!1)},Ye=xt.useCallback(()=>{Ie(null),Ee(null),Ae(),Se(!0)},[Ae]);return p.useEffect(()=>{if(!n)return;const a=new URLSearchParams(K.search);if(a.get("new")!=="1")return;Ye(),a.delete("new");const s=a.toString();ue(`${K.pathname}${s?`?${s}`:""}`,{replace:!0})},[n,K.pathname,K.search,ue,Ye]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:n?"Receitas":"Despesas"}),e.jsxs("p",{className:"text-gray-500",children:["Gerencie ",n?"os recebimentos":"os pagamentos"," da clínica"]})]}),e.jsxs("button",{onClick:Ye,className:`
            flex items-center gap-2 px-4 py-2 rounded-lg text-white font-medium transition-colors shadow-sm
            ${n?"bg-brand-600 hover:bg-brand-700":"bg-red-600 hover:bg-red-700"}
          `,children:[e.jsx(Sa,{size:20}),"Nova ",n?"Receita":"Despesa"]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-3 lg:items-center",children:[e.jsxs("div",{className:"relative flex-1 min-w-[220px]",children:[e.jsx(gt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:n?"Buscar por descrição ou paciente...":"Buscar por descrição ou fornecedor...",className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500",value:be,onChange:a=>La(a.target.value)})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("div",{className:"relative min-w-[160px]",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:e.jsx(qa,{size:16})}),e.jsx("input",{type:"date",value:ee,onChange:a=>Ua(a.target.value),className:"pl-9 pr-3 py-2 w-full border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500 text-sm text-gray-600"})]}),e.jsx("span",{className:"text-gray-400",children:"até"}),e.jsxs("div",{className:"relative min-w-[160px]",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:e.jsx(qa,{size:16})}),e.jsx("input",{type:"date",value:fe,onChange:a=>Xa(a.target.value),className:"pl-9 pr-3 py-2 w-full border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500 text-sm text-gray-600"})]}),!n&&e.jsxs("select",{value:qe,onChange:a=>$a(a.target.value),className:"px-3 py-2 border border-gray-200 rounded-lg text-sm bg-white min-w-[180px]",children:[e.jsx("option",{value:"competencia",children:"Data de competência"}),e.jsx("option",{value:"vencimento",children:"Data de vencimento"})]}),n&&e.jsxs("button",{onClick:G,className:"flex items-center justify-center gap-2 px-4 py-2 border border-gray-200 rounded-lg text-gray-600 hover:bg-gray-50 transition-colors",children:[e.jsx(Pa,{size:20}),"Filtrar"]})]})]}),!n&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("select",{value:V.tipoDespesa,onChange:a=>Re(s=>({...s,tipoDespesa:a.target.value})),className:"px-3 py-2 border border-gray-200 rounded-lg text-sm bg-white min-w-[180px]",children:[e.jsx("option",{value:"",children:"Tipo (fixo/variável)"}),e.jsx("option",{value:"fixo",children:"Fixo"}),e.jsx("option",{value:"variavel",children:"Variável"})]}),e.jsxs("select",{value:V.pessoaTipo,onChange:a=>Re(s=>({...s,pessoaTipo:a.target.value})),className:"px-3 py-2 border border-gray-200 rounded-lg text-sm bg-white min-w-[180px]",children:[e.jsx("option",{value:"",children:"Pessoa (F/J)"}),e.jsx("option",{value:"fisica",children:"Pessoa Física"}),e.jsx("option",{value:"juridica",children:"Pessoa Jurídica"})]}),e.jsxs("select",{value:V.status,onChange:a=>Re(s=>({...s,status:a.target.value})),className:"px-3 py-2 border border-gray-200 rounded-lg text-sm bg-white min-w-[140px]",children:[e.jsx("option",{value:"",children:"Status"}),e.jsx("option",{value:"paid",children:"Pago"}),e.jsx("option",{value:"pending",children:"À pagar"})]}),e.jsxs("button",{onClick:G,className:"flex items-center justify-center gap-2 px-4 py-2 border border-gray-200 rounded-lg text-gray-600 hover:bg-gray-50 transition-colors",children:[e.jsx(Pa,{size:20}),"Filtrar"]})]})]}),n&&O&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 xl:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Total Receita Faturada"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:P(O.totalReceita)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Total Crédito"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:P(O.totalCredito)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Total Débito"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:P(O.totalDebito)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Total Pix"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:P(O.totalPix)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Total Dinheiro"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:P(O.totalDinheiro)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Ticket médio"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:P(O.ticketMedio)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Procedimentos realizados"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:O.procedimentosRealizados})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Clientes atendidos"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:O.clientesAtendidos})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Recorrência"}),e.jsxs("p",{className:"text-xl font-bold text-gray-800",children:[O.recorrenciaPercent.toFixed(1),"% • Novos: ",O.novosClientes]})]})]}),!n&&se&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Total Despesas"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:P(se.total)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Quantidade de compras"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:se.quantidade})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Total Fixo"}),e.jsxs("p",{className:"text-xl font-bold text-gray-800",children:[P(se.totalFixo)," ",e.jsxs("span",{className:"text-sm text-gray-500",children:["(",se.pctFixo.toFixed(1),"%)"]})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs uppercase text-gray-500",children:"Total Variável"}),e.jsxs("p",{className:"text-xl font-bold text-gray-800",children:[P(se.totalVar)," ",e.jsxs("span",{className:"text-sm text-gray-500",children:["(",se.pctVar.toFixed(1),"%)"]})]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("span",{children:"Linhas por página:"}),e.jsxs("select",{value:De,onChange:a=>{za(parseInt(a.target.value,10)),ke(1)},className:"border border-gray-300 rounded px-2 py-1 text-sm bg-white",children:[e.jsx("option",{value:30,children:"30"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Total: ",ve.length]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx("button",{onClick:()=>ke(a=>Math.max(1,a-1)),disabled:ge===1,className:"px-2 py-1 border border-gray-300 rounded disabled:opacity-50",children:"‹"}),e.jsxs("span",{className:"px-2",children:["Página ",ge," / ",Qe]}),e.jsx("button",{onClick:()=>ke(a=>Math.min(Qe,a+1)),disabled:ge===Qe,className:"px-2 py-1 border border-gray-300 rounded disabled:opacity-50",children:"›"})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden min-h-[300px]",children:Ra?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-400",children:[e.jsx(Ia,{size:32,className:"animate-spin mb-2"}),e.jsx("p",{children:"Carregando dados..."})]}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"flex flex-col gap-2 px-4 py-3 border-b border-gray-100",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-700",children:["Selecionados: ",E.length]}),e.jsx("button",{onClick:st,disabled:te.length===0,className:"px-3 py-1 text-xs rounded border border-gray-200 text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:Na?"Desmarcar todos os registros":`Selecionar todos os registros (${te.length})`}),e.jsxs("select",{value:F.bank_account_id,onChange:a=>he(s=>({...s,bank_account_id:a.target.value})),className:"px-2 py-1 border rounded text-sm bg-white",children:[e.jsx("option",{value:"",children:"Banco (manter)"}),oe.map(a=>e.jsx("option",{value:a.id,children:a.nome_conta||a.name},a.id))]}),e.jsxs("select",{value:F.category_id,onChange:a=>he(s=>({...s,category_id:a.target.value})),className:"px-2 py-1 border rounded text-sm bg-white",children:[e.jsx("option",{value:"",children:"Categoria (manter)"}),me.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),e.jsxs("select",{value:F.forma_pagamento,onChange:a=>he(s=>({...s,forma_pagamento:a.target.value})),className:"px-2 py-1 border rounded text-sm bg-white",children:[e.jsx("option",{value:"",children:"Forma pgto (manter)"}),n?Fa.map(a=>e.jsx("option",{value:a,children:a},a)):Aa.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),e.jsx("input",{type:"date",value:F.data_competencia,onChange:a=>he(s=>({...s,data_competencia:a.target.value})),className:"px-2 py-1 border rounded text-sm",placeholder:"Data"}),e.jsx("button",{onClick:nt,className:"px-3 py-1 text-xs rounded bg-brand-600 text-white hover:bg-brand-700",disabled:E.length===0,children:"Aplicar edição em massa"}),e.jsx("button",{onClick:rt,className:"px-3 py-1 text-xs rounded border border-red-200 text-red-600 hover:bg-red-50",disabled:E.length===0,children:"Excluir selecionados"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs("button",{onClick:()=>Da("csv"),className:"flex items-center gap-1 px-3 py-2 text-xs border rounded-lg text-gray-700 hover:bg-gray-50",children:[e.jsx(Ea,{size:14})," CSV"]}),e.jsxs("button",{onClick:()=>Da("pdf"),className:"flex items-center gap-1 px-3 py-2 text-xs border rounded-lg text-gray-700 hover:bg-gray-50",children:[e.jsx(Ea,{size:14})," PDF"]})]})]}),e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-100 text-gray-500 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",className:"accent-brand-600",onChange:tt,checked:Fe.length>0&&Fe.every(a=>E.includes(a.id))})}),e.jsxs("th",{className:"px-6 py-4 cursor-pointer",onClick:()=>{le("description"),ie(q==="asc"?"desc":"asc")},children:["Descrição ",H==="description"&&(q==="asc"?"▲":"▼")]}),e.jsxs("th",{className:"px-6 py-4 cursor-pointer",onClick:()=>{le("paciente"),ie(q==="asc"?"desc":"asc")},children:[n?"Paciente":"Fornecedor"," ",H==="paciente"&&(q==="asc"?"▲":"▼")]}),e.jsxs("th",{className:"px-6 py-4 cursor-pointer",onClick:()=>{le("data_competencia"),ie(q==="asc"?"desc":"asc")},children:["Data ",H==="data_competencia"&&(q==="asc"?"▲":"▼")]}),!n&&e.jsxs("th",{className:"px-6 py-4 cursor-pointer",onClick:()=>{le("data_vencimento"),ie(q==="asc"?"desc":"asc")},children:["Vencimento ",H==="data_vencimento"&&(q==="asc"?"▲":"▼")]}),e.jsxs("th",{className:"px-6 py-4 cursor-pointer",onClick:()=>{le("categoria"),ie(q==="asc"?"desc":"asc")},children:["Categoria ",H==="categoria"&&(q==="asc"?"▲":"▼")]}),n&&e.jsx("th",{className:"px-6 py-4",children:"Forma Pag."}),!n&&e.jsx("th",{className:"px-6 py-4",children:"Status"}),e.jsxs("th",{className:"px-6 py-4 text-right cursor-pointer",onClick:()=>{le("valor"),ie(q==="asc"?"desc":"asc")},children:[n?"Valor faturado":"Valor"," ",H==="valor"&&(q==="asc"?"▲":"▼")]}),e.jsx("th",{className:"px-6 py-4 text-right",children:"Ações"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[Fe.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",className:"accent-brand-600",checked:E.includes(a.id),onChange:()=>at(a.id)})}),e.jsx("td",{className:"px-6 py-4 font-medium text-gray-800",children:a.description}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:n?a.paciente||"-":a.fornecedor||"-"}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:ne(a.data_competencia)}),!n&&e.jsx("td",{className:"px-6 py-4 text-gray-600",children:ne(a.data_vencimento||a.data_pagamento)}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-2 py-1 rounded-md text-xs font-medium",style:{backgroundColor:(a.categories?.cor_opcional||"#e5e7eb")+"20",color:a.categories?.cor_opcional||"#374151"},children:a.categories?.name||a.revenue_procedures?.[0]?.categoria||"Geral"})}),n&&e.jsx("td",{className:"px-6 py-4 text-gray-600 text-xs",children:a.forma_pagamento}),!n&&e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${a.status==="paid"?"bg-emerald-50 text-emerald-700":"bg-red-50 text-red-700"}`,children:a.status==="paid"?"Pago":"À pagar"})}),e.jsx("td",{className:`px-6 py-4 font-medium text-right ${n?"text-green-600":"text-red-600"}`,children:P(n?J(a):a.valor)}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>Wa(a),className:"p-1 text-gray-400 hover:text-brand-600 transition-colors",title:"Editar",children:e.jsx(yt,{size:16})}),!n&&e.jsx("button",{onClick:()=>{Le(a),Te(a.data_pagamento||new Date().toISOString().split("T")[0]),$e(!0)},className:"p-1 text-gray-400 hover:text-emerald-600 transition-colors",title:"Registrar data de pagamento",children:e.jsx(ft,{size:16})}),e.jsx("button",{onClick:()=>Ve({id:a.id,amount:Number(n?a.valor_liquido:a.valor),accountId:a.bank_account_id,description:a.description,shouldAffect:_e(a.status,n?"income":"expense")}),className:"p-1 text-gray-400 hover:text-red-600 transition-colors",title:"Excluir",children:e.jsx(ht,{size:16})})]})})]},a.id)),de.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:n?8:9,className:"px-6 py-12 text-center text-gray-400",children:"Nenhum lançamento encontrado no período."})})]})]})]})}),Y&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-red-900/20 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full border border-red-200",children:[e.jsxs("div",{className:"flex items-start gap-3 p-5 border-b border-red-100",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-red-50 text-red-600 flex items-center justify-center",children:e.jsx(Ta,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-red-700",children:"Ação irreversível"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Você está prestes a excluir ",n?"esta receita":"esta despesa",". Essa ação não pode ser desfeita."]})]})]}),e.jsxs("div",{className:"p-5 space-y-2",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-medium",children:"Descrição:"})," ",Y.description||"Sem descrição"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"O saldo da conta será ajustado automaticamente."})]}),e.jsxs("div",{className:"flex justify-end gap-2 p-4 bg-red-50/60",children:[e.jsx("button",{type:"button",onClick:()=>Ve(null),className:"px-3 py-2 text-sm border border-gray-200 rounded-lg text-gray-700 hover:bg-white",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:Ka,disabled:ga,className:"px-4 py-2 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-60",children:ga?"Excluindo...":"Sim, excluir"})]})]})}),Qa&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-red-900/20 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full border border-red-200",children:[e.jsxs("div",{className:"flex items-start gap-3 p-5 border-b border-red-100",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-red-50 text-red-600 flex items-center justify-center",children:e.jsx(Ta,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-red-700",children:"Ação irreversível"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Você está prestes a excluir ",E.length," registro(s). Essa ação não pode ser desfeita."]})]})]}),e.jsx("div",{className:"p-5 space-y-2",children:e.jsx("p",{className:"text-sm text-gray-700",children:"O saldo das contas será ajustado automaticamente para cada registro excluído."})}),e.jsxs("div",{className:"flex justify-end gap-2 p-4 bg-red-50/60",children:[e.jsx("button",{type:"button",onClick:()=>Pe(!1),className:"px-3 py-2 text-sm border border-gray-200 rounded-lg text-gray-700 hover:bg-white",disabled:ze,children:"Cancelar"}),e.jsx("button",{type:"button",onClick:ot,disabled:ze,className:"px-4 py-2 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-60",children:ze?"Excluindo...":"Sim, excluir"})]})]})}),Ha&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-4xl w-full p-6 space-y-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:[z?"Editar":"Nova"," ",n?"Receita":"Despesa"]}),(!n&&me.length===0||oe.length===0)&&e.jsxs("div",{className:"p-3 bg-yellow-50 text-yellow-700 rounded-lg flex items-start gap-2 text-sm",children:[e.jsx(bt,{size:16,className:"mt-0.5"}),e.jsxs("span",{children:["Atenção: Cadastre ",!n&&me.length===0?e.jsx("b",{children:"Categorias de despesas"}):null,!n&&me.length===0&&oe.length===0?" e ":"",oe.length===0?e.jsx("b",{children:"Contas Bancárias"}):null," antes de lançar."]})]}),e.jsxs("form",{onSubmit:Ja,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n?e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Paciente"}),e.jsx("input",{required:!0,name:"entity_name",value:t.entity_name,onChange:f,list:"entity_suggestions_top",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Digite o nome do paciente"}),e.jsx("datalist",{id:"entity_suggestions_top",children:Va.filter(a=>(t.entity_name||"").length>=3?a.name?.toLowerCase().includes(t.entity_name.toLowerCase()):!0).slice(0,10).map(a=>e.jsx("option",{value:a.name},a.id))})]}):e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descrição"}),e.jsx("input",{required:!0,name:"description",value:t.description,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Descreva a despesa"})]}),n&&e.jsxs("div",{className:"col-span-2 p-4 border border-gray-100 rounded-lg bg-white",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Adicionar procedimento"}),e.jsxs("select",{value:xe,onChange:a=>na(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"Selecione..."}),W.map(a=>e.jsxs("option",{value:a.id,children:[a.procedimento," (",P(a.valor_cobrado||0),")"]},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Qtd."}),e.jsx("input",{type:"number",min:"1",value:ra,onChange:a=>oa(a.target.value),className:"w-24 px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("button",{type:"button",onClick:Za,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 flex items-center gap-2",children:[e.jsx(Sa,{size:16})," Adicionar"]})]}),T.length>0&&e.jsxs("div",{className:"mt-3 border border-gray-100 rounded-lg overflow-hidden",children:[e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Procedimento"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Categoria"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Qtd."}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Valor"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Subtotal"}),e.jsx("th",{className:"px-3 py-2"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:T.map(a=>{const s=W.find(l=>l.id===a.id),r=s?.valor_cobrado?Number(s.valor_cobrado):0;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-3 py-2 text-gray-800",children:s?.procedimento||"-"}),e.jsx("td",{className:"px-3 py-2 text-gray-600",children:s?.categoria||"-"}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"number",min:"1",value:a.quantidade,onChange:l=>{const u=Math.max(1,parseInt(l.target.value||"1",10));pe(c=>c.map(m=>m.id===a.id?{...m,quantidade:u}:m))},className:"w-20 px-2 py-1 border border-gray-300 rounded"})}),e.jsx("td",{className:"px-3 py-2 text-gray-700",children:P(r)}),e.jsx("td",{className:"px-3 py-2 text-gray-800 font-semibold",children:P(r*(a.quantidade||1))}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsx("button",{type:"button",onClick:()=>pe(l=>l.filter(u=>u.id!==a.id)),className:"text-red-600 text-sm",children:"Remover"})})]},a.id)})})]}),e.jsxs("div",{className:"px-3 py-2 text-right text-sm font-semibold text-gray-800 bg-gray-50",children:["Subtotal procedimentos: ",P(et)]})]})]}),e.jsxs("div",{className:"col-span-2 p-4 bg-gray-50 rounded-lg grid grid-cols-1 md:grid-cols-4 gap-4 border border-gray-100",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Valor Bruto"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 font-bold",children:"R$"}),e.jsx("input",{required:!0,name:"gross_amount",type:"number",step:"0.01",value:t.gross_amount,onChange:f,className:"w-full pl-8 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"0,00"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Desconto"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 font-bold",children:"R$"}),e.jsx("input",{name:"discount",type:"number",step:"0.01",value:t.discount,onChange:f,className:"w-full pl-8 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"0,00"})]})]}),n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Taxa (%)"}),e.jsx("input",{name:"tax_rate",type:"number",step:"0.01",value:t.tax_rate,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"0"}),e.jsxs("div",{className:"text-xs text-red-500 mt-1 font-medium",children:["- R$ ",t.tax_amount]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-1",children:"Valor Líquido"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-green-600 font-bold",children:"R$"}),e.jsx("input",{readOnly:!0,value:t.liquid_amount,className:"w-full pl-8 pr-3 py-2 border border-green-200 bg-green-50 text-green-700 font-bold rounded-lg outline-none"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:n?"Data Competência":"Data da Compra"}),e.jsx("input",{required:!0,name:"date",type:"date",value:t.date,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),!n&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Vencimento"}),e.jsx("input",{required:!0,name:"due_date",type:"date",value:t.due_date,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),!n&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Categoria"}),e.jsxs("select",{required:!0,name:"category_id",value:t.category_id,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"Selecione..."}),me.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Conta Bancária"}),e.jsxs("select",{required:!0,name:"bank_account_id",value:t.bank_account_id,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"Selecione..."}),oe.map(a=>e.jsxs("option",{value:a.id,children:[a.nome_conta||a.name||"Conta sem nome"," (",a.banco||a.bank||"Banco",")"]},a.id))]})]}),n?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Forma de Pagamento"}),e.jsx("select",{name:"payment_method",value:t.payment_method,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:Fa.map(a=>e.jsx("option",{value:a,children:a},a))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fornecedor"}),e.jsxs("select",{value:ma,onChange:a=>{const s=a.target.value;Be(s);const r=da.find(l=>l.id===s);S(l=>({...l,entity_name:r?.nome||""}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"Selecione fornecedor..."}),da.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Forma de Pagamento"}),e.jsx("select",{name:"payment_method",value:t.payment_method,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:Aa.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]})]}),!n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de custo"}),e.jsxs("select",{name:"tipo_despesa",value:t.tipo_despesa||"",onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"fixo",children:"Fixo"}),e.jsx("option",{value:"variavel",children:"Variável"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pessoa"}),e.jsxs("select",{name:"pessoa_tipo",value:t.pessoa_tipo||"",onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"fisica",children:"Pessoa Física"}),e.jsx("option",{value:"juridica",children:"Pessoa Jurídica"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{name:"status",value:t.status,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"paid",children:"Pago"}),e.jsx("option",{value:"pending",children:"À pagar"})]})]})]}),n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Profissional de venda"}),e.jsxs("select",{value:Ne.venda,onChange:a=>we(s=>({...s,venda:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"Selecione..."}),la.filter(a=>a.tipo==="venda").map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Profissional de execução"}),e.jsxs("select",{value:Ne.execucao,onChange:a=>we(s=>({...s,execucao:a.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"Selecione..."}),la.filter(a=>a.tipo==="execucao").map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]})]})]}),n&&e.jsxs("div",{className:"col-span-2 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[e.jsxs("span",{children:["Liquidação prevista: ",e.jsx("span",{className:"font-semibold text-gray-800",children:ne(lt)})]}),e.jsx("span",{className:"text-gray-400",children:"Ajustada conforme a forma de pagamento"})]}),t.payment_method==="Cartão de Crédito"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bandeira"}),e.jsxs("select",{name:"card_brand",value:t.card_brand,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"",children:"Selecione..."}),Me.map(a=>e.jsx("option",{value:a.bandeira,children:a.bandeira},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Parcelas"}),e.jsx("input",{name:"installments",type:"number",min:"1",value:t.installments,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Ex: 10"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"NSU"}),e.jsx("input",{name:"nsu",value:t.nsu,onChange:f,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Código autorizador"})]}),e.jsx("div",{className:"text-sm text-gray-600 flex items-center",children:"Crédito: D+30 dias"})]}),t.payment_method==="Cartão de Débito"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"NSU"}),e.jsx("input",{name:"nsu",value:t.nsu,onChange:f,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Código autorizador"})]}),e.jsx("div",{className:"text-sm text-gray-600 flex items-center",children:"Débito: D+1 dia útil"})]}),t.payment_method==="Boleto"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Parcelas"}),e.jsx("input",{name:"installments",type:"number",min:"1",value:t.installments,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Primeiro Vencimento"}),e.jsx("input",{name:"boleto_due_date",type:"date",value:t.boleto_due_date,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsx("div",{className:"text-sm text-gray-600 flex items-center",children:"Boleto: conforme vencimento"})]}),it>1&&e.jsxs("div",{className:"col-span-3 p-3 border border-gray-100 rounded-lg bg-gray-50 space-y-2",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Defina o vencimento de cada parcela."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:Ce.map((a,s)=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:["Parcela ",s+1]}),e.jsx("input",{type:"date",value:a.vencimento,onChange:r=>{const l=r.target.value;X(u=>{const c=[...u];return c[s]={...c[s],vencimento:l},c}),Z(!0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]},`boleto-${s}`))})]})]}),t.payment_method==="Cheque"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Número do Cheque"}),e.jsx("input",{name:"cheque_number",value:t.cheque_number,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Banco"}),e.jsx("input",{name:"cheque_bank",value:t.cheque_bank,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Vencimento"}),e.jsx("input",{name:"cheque_due_date",type:"date",value:t.cheque_due_date,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantidade de Folhas"}),e.jsx("input",{name:"cheque_pages",type:"number",min:"1",value:t.cheque_pages,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valor por Folha"}),e.jsx("input",{name:"cheque_value",type:"number",step:"0.01",value:t.cheque_value,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsx("div",{className:"text-sm text-gray-600 flex items-center",children:"Cheque: liquidação no vencimento"})]}),ct>1&&e.jsxs("div",{className:"col-span-3 p-3 border border-gray-100 rounded-lg bg-gray-50 space-y-2",children:[e.jsx("p",{className:"text-xs text-gray-600",children:"Defina o número da folha e o vencimento de cada cheque."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Ce.map((a,s)=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-600",children:["Cheque ",s+1]}),e.jsx("input",{type:"text",value:a.numero_folha||"",onChange:r=>{const l=r.target.value;X(u=>{const c=[...u];return c[s]={...c[s],numero_folha:l},c}),Z(!0)},placeholder:"Numero da folha",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"}),e.jsx("input",{type:"date",value:a.vencimento,onChange:r=>{const l=r.target.value;X(u=>{const c=[...u];return c[s]={...c[s],vencimento:l},c}),Z(!0)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]},`cheque-${s}`))})]})]})]}),!n&&e.jsxs("div",{className:"col-span-2 p-4 border border-gray-100 rounded-lg bg-gray-50 space-y-3",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx("input",{id:"is_recurring",name:"is_recurring",type:"checkbox",checked:t.is_recurring,onChange:f,className:"h-4 w-4 text-brand-600 border-gray-300 rounded"}),"Este custo é recorrente?"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx("input",{id:"is_installment",name:"is_installment",type:"checkbox",checked:t.is_installment,onChange:f,className:"h-4 w-4 text-brand-600 border-gray-300 rounded"}),"Este custo é parcelado?"]})]}),t.is_recurring&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Intervalo"}),e.jsxs("select",{name:"recurrence_interval",value:t.recurrence_interval,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[e.jsx("option",{value:"quinzenal",children:"Quinzenal"}),e.jsx("option",{value:"mensal",children:"Mensal"}),e.jsx("option",{value:"trimestral",children:"Trimestral"}),e.jsx("option",{value:"anual",children:"Anual"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Repetições"}),e.jsx("input",{name:"recurrence_count",type:"number",min:"1",value:t.recurrence_count,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",placeholder:"Ex: 10"})]}),e.jsx("div",{className:"text-xs text-gray-500 flex items-center",children:"As repetições serão lançamentos individuais seguindo o intervalo e vencimento informado."})]}),t.is_installment&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Parcelas"}),e.jsx("input",{name:"installments",type:"number",min:"1",value:t.installments,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsx("div",{className:"text-xs text-gray-500 flex items-center",children:"Valor será distribuído em parcelas a partir da primeira data de vencimento."})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observações"}),e.jsx("textarea",{name:"observations",rows:2,value:t.observations,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-100 mt-4",children:[e.jsx("button",{type:"button",onClick:()=>{Se(!1),Ie(null),Ee(null),Ae()},className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsxs("button",{type:"submit",disabled:fa,className:"px-4 py-2 bg-brand-600 rounded-lg text-white hover:bg-brand-700 transition-colors disabled:opacity-50 flex items-center gap-2",children:[fa&&e.jsx(Ia,{size:16,className:"animate-spin"}),z?"Atualizar":"Salvar"]})]})]})]})}),Ya&&L&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full p-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Registrar data de pagamento"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Despesa:"})," ",L.description||"Despesa"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Vencimento:"})," ",ne(L.data_vencimento||L.data_pagamento||L.data_competencia)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de pagamento real"}),e.jsx("input",{type:"date",value:Ue,onChange:a=>Te(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>{$e(!1),Le(null),Te("")},className:"px-4 py-2 border border-gray-200 rounded-lg text-gray-600 hover:bg-gray-50",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:async()=>{if(!Ue){alert("Informe a data de pagamento.");return}const{error:a}=await _.from(N).update({data_pagamento:Ue,status:"paid"}).eq("id",L.id);if(a){alert(`Erro ao registrar pagamento: ${a.message}`);return}if(L.status!=="paid"){const s=Number(L.valor||0);await ce(L.bank_account_id,-s)}$e(!1),Le(null),Te(""),G()},className:"px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700",children:"Salvar"})]})]})})]})};export{Et as default};
