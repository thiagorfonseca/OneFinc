import{c as lt,R as $,r as A,u as gt,a as yt,j as e,W as bt,s as we}from"./index-DRNvAEYE.js";import{f as N,a as Me,b as Ae}from"./utils-Bgz2xRk4.js";import{L as vt}from"./loader-2-B70kWO0i.js";import{C as Qe}from"./calendar-D2p3OeMO.js";import{i as Nt,c as Ge,D as Dt,f as jt,E as wt,L as $e,a as Pe,C as At,A as Pt,b as xe,d as St,e as Le,h as Et,g as Rt,j as ct,u as Ot,G as kt,k as Ze,l as Ct,X as Ee,Y as Re,m as _t,R as Je,n as Be,T as Fe,B as Se,o as et}from"./generateCategoricalChart-ieMNn3Dd.js";import{B as tt}from"./BarChart-BSDVqbU7.js";const Tt=lt("ArrowDownCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 8v8",key:"napkw2"}],["path",{d:"m8 12 4 4 4-4",key:"k98ssh"}]]),It=lt("ArrowUpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]]);var Mt=["type","layout","connectNulls","ref"],$t=["key"];function ue(r){"@babel/helpers - typeof";return ue=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ue(r)}function at(r,n){if(r==null)return{};var t=Bt(r,n),s,i;if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(r);for(i=0;i<h.length;i++)s=h[i],!(n.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(r,s)&&(t[s]=r[s])}return t}function Bt(r,n){if(r==null)return{};var t={};for(var s in r)if(Object.prototype.hasOwnProperty.call(r,s)){if(n.indexOf(s)>=0)continue;t[s]=r[s]}return t}function ge(){return ge=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=t[s])}return r},ge.apply(this,arguments)}function rt(r,n){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(r);n&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,s)}return t}function F(r){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?arguments[n]:{};n%2?rt(Object(t),!0).forEach(function(s){K(r,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):rt(Object(t)).forEach(function(s){Object.defineProperty(r,s,Object.getOwnPropertyDescriptor(t,s))})}return r}function de(r){return Vt(r)||Ut(r)||Lt(r)||Ft()}function Ft(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Lt(r,n){if(r){if(typeof r=="string")return Ue(r,n);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ue(r,n)}}function Ut(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function Vt(r){if(Array.isArray(r))return Ue(r)}function Ue(r,n){(n==null||n>r.length)&&(n=r.length);for(var t=0,s=new Array(n);t<n;t++)s[t]=r[t];return s}function zt(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function st(r,n){for(var t=0;t<n.length;t++){var s=n[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(r,ut(s.key),s)}}function Ht(r,n,t){return n&&st(r.prototype,n),t&&st(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}function Kt(r,n,t){return n=Oe(n),Wt(r,dt()?Reflect.construct(n,t||[],Oe(r).constructor):n.apply(r,t))}function Wt(r,n){if(n&&(ue(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return qt(r)}function qt(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function dt(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(dt=function(){return!!r})()}function Oe(r){return Oe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Oe(r)}function Yt(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),n&&Ve(r,n)}function Ve(r,n){return Ve=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,i){return s.__proto__=i,s},Ve(r,n)}function K(r,n,t){return n=ut(n),n in r?Object.defineProperty(r,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[n]=t,r}function ut(r){var n=Xt(r,"string");return ue(n)=="symbol"?n:n+""}function Xt(r,n){if(ue(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var s=t.call(r,n);if(ue(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var ye=(function(r){function n(){var t;zt(this,n);for(var s=arguments.length,i=new Array(s),h=0;h<s;h++)i[h]=arguments[h];return t=Kt(this,n,[].concat(i)),K(t,"state",{isAnimationFinished:!0,totalLength:0}),K(t,"generateSimpleStrokeDasharray",function(d,u){return"".concat(u,"px ").concat(d-u,"px")}),K(t,"getStrokeDasharray",function(d,u,x){var D=x.reduce(function(S,M){return S+M});if(!D)return t.generateSimpleStrokeDasharray(u,d);for(var P=Math.floor(d/D),E=d%D,R=u-d,O=[],w=0,j=0;w<x.length;j+=x[w],++w)if(j+x[w]>E){O=[].concat(de(x.slice(0,w)),[E-j]);break}var C=O.length%2===0?[0,R]:[R];return[].concat(de(n.repeat(x,P)),de(O),C).map(function(S){return"".concat(S,"px")}).join(", ")}),K(t,"id",Ot("recharts-line-")),K(t,"pathRef",function(d){t.mainCurve=d}),K(t,"handleAnimationEnd",function(){t.setState({isAnimationFinished:!0}),t.props.onAnimationEnd&&t.props.onAnimationEnd()}),K(t,"handleAnimationStart",function(){t.setState({isAnimationFinished:!1}),t.props.onAnimationStart&&t.props.onAnimationStart()}),t}return Yt(n,r),Ht(n,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var s=this.getTotalLength();this.setState({totalLength:s})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var s=this.getTotalLength();s!==this.state.totalLength&&this.setState({totalLength:s})}}},{key:"getTotalLength",value:function(){var s=this.mainCurve;try{return s&&s.getTotalLength&&s.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(s,i){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var h=this.props,d=h.points,u=h.xAxis,x=h.yAxis,D=h.layout,P=h.children,E=jt(P,wt);if(!E)return null;var R=function(j,C){return{x:j.x,y:j.y,value:j.value,errorVal:ct(j.payload,C)}},O={clipPath:s?"url(#clipPath-".concat(i,")"):null};return $.createElement($e,O,E.map(function(w){return $.cloneElement(w,{key:"bar-".concat(w.props.dataKey),data:d,xAxis:u,yAxis:x,layout:D,dataPointFormatter:R})}))}},{key:"renderDots",value:function(s,i,h){var d=this.props.isAnimationActive;if(d&&!this.state.isAnimationFinished)return null;var u=this.props,x=u.dot,D=u.points,P=u.dataKey,E=Pe(this.props,!1),R=Pe(x,!0),O=D.map(function(j,C){var S=F(F(F({key:"dot-".concat(C),r:3},E),R),{},{index:C,cx:j.x,cy:j.y,value:j.value,dataKey:P,payload:j.payload,points:D});return n.renderDotItem(x,S)}),w={clipPath:s?"url(#clipPath-".concat(i?"":"dots-").concat(h,")"):null};return $.createElement($e,ge({className:"recharts-line-dots",key:"dots"},w),O)}},{key:"renderCurveStatically",value:function(s,i,h,d){var u=this.props,x=u.type,D=u.layout,P=u.connectNulls;u.ref;var E=at(u,Mt),R=F(F(F({},Pe(E,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:i?"url(#clipPath-".concat(h,")"):null,points:s},d),{},{type:x,layout:D,connectNulls:P});return $.createElement(At,ge({},R,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(s,i){var h=this,d=this.props,u=d.points,x=d.strokeDasharray,D=d.isAnimationActive,P=d.animationBegin,E=d.animationDuration,R=d.animationEasing,O=d.animationId,w=d.animateNewValues,j=d.width,C=d.height,S=this.state,M=S.prevPoints,L=S.totalLength;return $.createElement(Pt,{begin:P,duration:E,isActive:D,easing:R,from:{t:0},to:{t:1},key:"line-".concat(O),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(q){var B=q.t;if(M){var re=M.length/u.length,U=u.map(function(k,le){var G=Math.floor(le*re);if(M[G]){var Z=M[G],J=xe(Z.x,k.x),ke=xe(Z.y,k.y);return F(F({},k),{},{x:J(B),y:ke(B)})}if(w){var Ce=xe(j*2,k.x),_e=xe(C/2,k.y);return F(F({},k),{},{x:Ce(B),y:_e(B)})}return F(F({},k),{},{x:k.x,y:k.y})});return h.renderCurveStatically(U,s,i)}var ie=xe(0,L),Y=ie(B),X;if(x){var Q="".concat(x).split(/[,\s]+/gim).map(function(k){return parseFloat(k)});X=h.getStrokeDasharray(Y,L,Q)}else X=h.generateSimpleStrokeDasharray(L,Y);return h.renderCurveStatically(u,s,i,{strokeDasharray:X})})}},{key:"renderCurve",value:function(s,i){var h=this.props,d=h.points,u=h.isAnimationActive,x=this.state,D=x.prevPoints,P=x.totalLength;return u&&d&&d.length&&(!D&&P>0||!St(D,d))?this.renderCurveWithAnimation(s,i):this.renderCurveStatically(d,s,i)}},{key:"render",value:function(){var s,i=this.props,h=i.hide,d=i.dot,u=i.points,x=i.className,D=i.xAxis,P=i.yAxis,E=i.top,R=i.left,O=i.width,w=i.height,j=i.isAnimationActive,C=i.id;if(h||!u||!u.length)return null;var S=this.state.isAnimationFinished,M=u.length===1,L=Ge("recharts-line",x),q=D&&D.allowDataOverflow,B=P&&P.allowDataOverflow,re=q||B,U=Le(C)?this.id:C,ie=(s=Pe(d,!1))!==null&&s!==void 0?s:{r:3,strokeWidth:2},Y=ie.r,X=Y===void 0?3:Y,Q=ie.strokeWidth,k=Q===void 0?2:Q,le=Et(d)?d:{},G=le.clipDot,Z=G===void 0?!0:G,J=X*2+k;return $.createElement($e,{className:L},q||B?$.createElement("defs",null,$.createElement("clipPath",{id:"clipPath-".concat(U)},$.createElement("rect",{x:q?R:R-O/2,y:B?E:E-w/2,width:q?O:O*2,height:B?w:w*2})),!Z&&$.createElement("clipPath",{id:"clipPath-dots-".concat(U)},$.createElement("rect",{x:R-J/2,y:E-J/2,width:O+J,height:w+J}))):null,!M&&this.renderCurve(re,U),this.renderErrorBar(re,U),(M||d)&&this.renderDots(re,Z,U),(!j||S)&&Rt.renderCallByParent(this.props,u))}}],[{key:"getDerivedStateFromProps",value:function(s,i){return s.animationId!==i.prevAnimationId?{prevAnimationId:s.animationId,curPoints:s.points,prevPoints:i.curPoints}:s.points!==i.curPoints?{curPoints:s.points}:null}},{key:"repeat",value:function(s,i){for(var h=s.length%2!==0?[].concat(de(s),[0]):s,d=[],u=0;u<i;++u)d=[].concat(de(d),de(h));return d}},{key:"renderDotItem",value:function(s,i){var h;if($.isValidElement(s))h=$.cloneElement(s,i);else if(Nt(s))h=s(i);else{var d=i.key,u=at(i,$t),x=Ge("recharts-line-dot",typeof s!="boolean"?s.className:"");h=$.createElement(Dt,ge({key:d},u,{className:x}))}return h}}])})(A.PureComponent);K(ye,"displayName","Line");K(ye,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!kt.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});K(ye,"getComposedData",function(r){var n=r.props,t=r.xAxis,s=r.yAxis,i=r.xAxisTicks,h=r.yAxisTicks,d=r.dataKey,u=r.bandSize,x=r.displayedData,D=r.offset,P=n.layout,E=x.map(function(R,O){var w=ct(R,d);return P==="horizontal"?{x:Ze({axis:t,ticks:i,bandSize:u,entry:R,index:O}),y:Le(w)?null:s.scale(w),value:w,payload:R}:{x:Le(w)?null:t.scale(w),y:Ze({axis:s,ticks:h,bandSize:u,entry:R,index:O}),value:w,payload:R}});return F({points:E,layout:P},D)});var Qt=Ct({chartName:"LineChart",GraphicalChild:ye,axisComponents:[{axisType:"xAxis",AxisComp:Ee},{axisType:"yAxis",AxisComp:Re}],formatAxisMap:_t});const Gt={DINHEIRO:{diasAtePrimeiroRecebimento:0,intervaloDias:0},PIX:{diasAtePrimeiroRecebimento:0,intervaloDias:0},DEBITO:{diasAtePrimeiroRecebimento:1,intervaloDias:0,usarDiasUteis:!0},CREDITO:{diasAtePrimeiroRecebimento:30,intervaloDias:30},BOLETO:{usarDataVencimento:!0},CHEQUE:{usarDataVencimento:!0},TRANSFERENCIA:{diasAtePrimeiroRecebimento:0,intervaloDias:0},CONVENIO:{diasAtePrimeiroRecebimento:30,intervaloDias:30},OUTRO:{diasAtePrimeiroRecebimento:0,intervaloDias:0}},nt=(r,n)=>{const t=new Date(r);return t.setDate(t.getDate()+n),t},Zt=(r,n)=>{const t=new Date(r);let s=0;for(;s<n;){t.setDate(t.getDate()+1);const i=t.getDay();i!==0&&i!==6&&(s+=1)}return t},ot=(r,n)=>{const t=new Date(r);return t.setMonth(t.getMonth()+n),t},Jt=(r,n)=>{const t=Math.floor(r/n*100)/100,s=Array(n).fill(t),i=t*n,h=Math.round((r-i)*100)/100;return s[s.length-1]=Math.round((s[s.length-1]+h)*100)/100,s};function ea(r){const n=[];return r.forEach(t=>{const s=(t.datasParcelas||[]).filter(Boolean),i=Math.max(1,s.length||t.numeroParcelas||1),h=Jt(t.valorTotal,i),d=[];if(s.length)d.push(...s.slice(0,i));else if(t.tipo==="RECEITA"){const u=Gt[t.formaPagamento],x=t.dataVencimento||t.dataEmissao,D=u.usarDataVencimento?x:u.diasAtePrimeiroRecebimento&&!t.dataVencimento?u.usarDiasUteis?Zt(x,u.diasAtePrimeiroRecebimento):nt(x,u.diasAtePrimeiroRecebimento):x;for(let P=0;P<i;P++)u.intervaloDias&&P>0?d.push(nt(D,u.intervaloDias*P)):!u.intervaloDias&&P>0?d.push(ot(D,P)):d.push(D)}else{const u=t.dataVencimento||t.dataEmissao;for(let x=0;x<i;x++)d.push(ot(u,x))}h.forEach((u,x)=>{const D=t.status==="REALIZADO"&&!!t.dataBaixa;n.push({lancamentoId:t.id,tipo:t.tipo,dataPrevista:d[x]||t.dataEmissao,valor:u,status:D?"REALIZADO":"PREVISTO",dataRealizado:D?t.dataBaixa:void 0})})}),n}function ta(r){const n=new Map;return r.forEach(t=>{const s=t.dataPrevista.toISOString().split("T")[0],i=n.get(s)||{data:new Date(s),totalReceitasPrevistas:0,totalDespesasPrevistas:0,saldoPrevistoDia:0};t.tipo==="RECEITA"?i.totalReceitasPrevistas+=t.valor:i.totalDespesasPrevistas+=t.valor,i.saldoPrevistoDia=i.totalReceitasPrevistas-i.totalDespesasPrevistas,n.set(s,i)}),Array.from(n.values()).sort((t,s)=>t.data.getTime()-s.data.getTime())}function aa(r){const n=new Map;return r.forEach(t=>{const s=t.dataPrevista.getFullYear(),i=t.dataPrevista.getMonth()+1,h=`${s}-${i}`,d=n.get(h)||{ano:s,mes:i,totalReceitasPrevistas:0,totalDespesasPrevistas:0,saldoPrevistoMes:0};t.tipo==="RECEITA"?d.totalReceitasPrevistas+=t.valor:d.totalDespesasPrevistas+=t.valor,d.saldoPrevistoMes=d.totalReceitasPrevistas-d.totalDespesasPrevistas,n.set(h,d)}),Array.from(n.values()).sort((t,s)=>t.ano-s.ano||t.mes-s.mes)}function it(r,n){let t=n;return r.map(s=>(t+=s.saldoPrevistoDia,{...s,saldoAcumulado:t}))}const ca=()=>{const{effectiveClinicId:r,isAdmin:n,selectedClinicId:t}=gt(),[s,i]=yt(),[h,d]=A.useState(!0),[u,x]=A.useState([]),[D,P]=A.useState([]),[E,R]=A.useState([]),[O,w]=A.useState([]),[j,C]=A.useState(()=>new Date(new Date().getFullYear(),new Date().getMonth(),1)),[S,M]=A.useState(()=>new Date(new Date().getFullYear(),new Date().getMonth()+1,0)),L=a=>!a||Number.isNaN(a.getTime())?"":a.toISOString().split("T")[0],q=a=>{if(!a)return null;const o=new Date(`${a}T00:00:00`);return Number.isNaN(o.getTime())?null:o},B=a=>{if(typeof a=="string"){const c=Number(a.replace(",","."));return isNaN(c)?0:c}const o=Number(a||0);return isNaN(o)?0:o},re=async(a,o,c)=>{if(!a.length)return a;const m=l=>{if(!l)return null;const p=new Date(l);if(!Number.isNaN(p.getTime()))return p;const y=new Date(`${l}T00:00:00`);return Number.isNaN(y.getTime())?null:y},b=(l,p)=>{const y=new Date(l);return y.setDate(y.getDate()+p),y},g=(l,p)=>{const y=new Date(l);let T=0;for(;T<p;){y.setDate(y.getDate()+1);const I=y.getDay();I!==0&&I!==6&&(T+=1)}return y},_=(l,p)=>{const y=new Date(l);return y.setMonth(y.getMonth()+p),y},pe=l=>{const p=(l||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase();return p.includes("CREDITO")?"CREDITO":p.includes("DEBITO")?"DEBITO":p.includes("PIX")?"PIX":p.includes("BOLETO")?"BOLETO":p.includes("CHEQUE")?"CHEQUE":p.includes("TRANSFER")||p.includes("TED")||p.includes("DOC")?"TRANSFERENCIA":p.includes("CONVENIO")?"CONVENIO":p.includes("DINHEIRO")||p.includes("CASH")?"DINHEIRO":"OUTRO"},he=(l,p)=>{const y=Math.floor(l/p*100)/100,T=Array(p).fill(y),I=y*p,te=Math.round((l-I)*100)/100;return T[T.length-1]=Math.round((T[T.length-1]+te)*100)/100,T},z=l=>{if(!l)return[];try{const p=Array.isArray(l)?l:typeof l=="string"?JSON.parse(l):[];return Array.isArray(p)?p.map(y=>typeof y=="string"?{vencimento:y}:!y||typeof y!="object"?null:{vencimento:y.vencimento||y.due_date||y.data||y.date||""}).filter(Boolean):[]}catch{return[]}},oe=new Date;oe.setHours(0,0,0,0);const fe=l=>{const p=Number(l.valor_liquido??l.valor_bruto??l.valor??0);if(!Number.isFinite(p)||p===0)return 0;const y=z(l.recebimento_parcelas).map(H=>m(H.vencimento)).filter(Boolean),T=Math.max(1,y.length||parseInt(l.parcelas||"1",10)||1),I=pe(l.forma_pagamento),te=m(l.data_recebimento),ce=m(l.data_competencia);let ae=null;if(I==="BOLETO"||I==="CHEQUE"?ae=te||ce:I==="CREDITO"||I==="CONVENIO"?ae=te||(ce?b(ce,30):null):I==="DEBITO"?ae=te||(ce?g(ce,1):null):ae=te||ce,!ae&&y.length===0)return 0;const Ie=I==="CREDITO"||I==="CONVENIO"?30:0,xt=he(p,T);let Xe=0;for(let H=0;H<T;H+=1){let je=y[H]||ae;je&&(y[H]||(Ie&&H>0?je=b(ae,Ie*H):!Ie&&T>1&&H>0&&(je=_(ae,H))),je<=oe&&(Xe+=xt[H]||0))}return Xe},V=new Map;o.forEach(l=>{if(!l.bank_account_id)return;const p=fe(l);!Number.isFinite(p)||p===0||V.set(l.bank_account_id,(V.get(l.bank_account_id)||0)+p)});const W=new Map;c.forEach(l=>{if(!l.bank_account_id||l.status!=="paid")return;const p=Number(l.valor??0);Number.isFinite(p)&&W.set(l.bank_account_id,(W.get(l.bank_account_id)||0)+p)});const f=[],v=a.map(l=>{const p=B(l.initial_balance??0),y=V.get(l.id)||0,T=W.get(l.id)||0,I=p+y-T,te=B(l.current_balance??l.initial_balance??0);return Math.abs(te-I)>.009&&f.push({id:l.id,current_balance:I}),{...l,current_balance:I}});return f.length&&await Promise.all(f.map(l=>we.from("bank_accounts").update({current_balance:l.current_balance}).eq("id",l.id))),v},[U,ie]=A.useState(()=>s.get("tab")==="caixa"?"caixa":"dre"),[Y,X]=A.useState("linha"),Q=A.useRef(null);A.useEffect(()=>{if(!r&&!n)return;(async()=>{d(!0);try{const o=r;let c=we.from("revenues").select("id, description, valor_liquido, valor_bruto, data_competencia, data_recebimento, forma_pagamento, parcelas, status, recebimento_parcelas, categories(name), bank_account_id");o&&(c=c.eq("clinic_id",o));const{data:m}=await c;let b=we.from("expenses").select("id, description, valor, data_competencia, data_pagamento, data_vencimento, forma_pagamento, parcelas, status, categories(name), bank_account_id");o&&(b=b.eq("clinic_id",o));const{data:g}=await b;let _=we.from("bank_accounts").select("id, clinic_id, current_balance, initial_balance");o&&(_=_.eq("clinic_id",o));const{data:pe}=await _,he=await re(pe||[],m||[],g||[]);x(he||[]),R(m||[]),w(g||[]);const z=f=>{if(!f)return;const v=new Date(f);return Number.isNaN(v.getTime())?void 0:v},oe=f=>{const v=(f||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase();return v.includes("CREDITO")?"CREDITO":v.includes("DEBITO")?"DEBITO":v.includes("PIX")?"PIX":v.includes("BOLETO")?"BOLETO":v.includes("CHEQUE")?"CHEQUE":v.includes("TRANSFER")||v.includes("TED")||v.includes("DOC")?"TRANSFERENCIA":v.includes("CONVENIO")?"CONVENIO":v.includes("DINHEIRO")||v.includes("CASH")?"DINHEIRO":"OUTRO"},fe=f=>{if(!f)return[];try{const v=Array.isArray(f)?f:typeof f=="string"?JSON.parse(f):[];return Array.isArray(v)?v.map(l=>typeof l=="string"?z(l):!l||typeof l!="object"?null:z(l.vencimento||l.due_date||l.data||l.date||"")).filter(Boolean):[]}catch{return[]}},V=[];(m||[]).forEach(f=>{const v=z(f.data_competencia);if(!v)return;const l=fe(f.recebimento_parcelas);V.push({id:f.id,tipo:"RECEITA",descricao:f.description||"Receita",dataEmissao:v,dataVencimento:z(f.data_recebimento),formaPagamento:oe(f.forma_pagamento),valorTotal:f.valor_liquido||f.valor_bruto||0,numeroParcelas:Math.max(1,l.length||parseInt(f.parcelas||1,10)),datasParcelas:l.length?l:void 0,status:f.status==="paid"?"REALIZADO":"PREVISTO",dataBaixa:z(f.data_recebimento)})}),(g||[]).forEach(f=>{const v=z(f.data_competencia);v&&V.push({id:f.id,tipo:"DESPESA",descricao:f.description||"Despesa",dataEmissao:v,dataVencimento:z(f.data_vencimento||f.data_competencia),formaPagamento:oe(f.forma_pagamento),valorTotal:f.valor||0,numeroParcelas:parseInt(f.parcelas||1,10),status:f.status==="paid"?"REALIZADO":"PREVISTO",dataBaixa:z(f.data_pagamento)})});const W=ea(V);P(W)}catch(o){console.error("Erro ao carregar dashboard:",o)}finally{d(!1)}})()},[r,n,t]);const k=a=>{if(!a)return!1;const o=a instanceof Date?a:new Date(a);return o>=j&&o<=S},le=a=>a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"),G=(a,o)=>{const c=o.map(m=>`<Row>${m.map(g=>{const _=g.type==="Number"?g.value:le(String(g.value));return`<Cell><Data ss:Type="${g.type}">${_}</Data></Cell>`}).join("")}</Row>`).join("");return`<?xml version="1.0"?>
<Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet" xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet"><Worksheet ss:Name="${le(a)}"><Table>${c}</Table></Worksheet></Workbook>`},Z=a=>new Promise(o=>{if(!a){o(null);return}const c=a.querySelector("svg");if(!c){o(null);return}const m=c.getBoundingClientRect(),b=Math.max(1,Math.floor(m.width))||Number(c.getAttribute("width"))||800,g=Math.max(1,Math.floor(m.height))||Number(c.getAttribute("height"))||400,_=c.cloneNode(!0);_.setAttribute("xmlns","http://www.w3.org/2000/svg"),_.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),_.setAttribute("width",String(b)),_.setAttribute("height",String(g)),_.getAttribute("viewBox")||_.setAttribute("viewBox",`0 0 ${b} ${g}`);const pe=c.querySelectorAll("*"),he=_.querySelectorAll("*");pe.forEach((f,v)=>{const l=he[v];if(!l||!(f instanceof Element))return;const p=window.getComputedStyle(f),y=[`fill:${p.getPropertyValue("fill")};`,`stroke:${p.getPropertyValue("stroke")};`,`stroke-width:${p.getPropertyValue("stroke-width")};`,`font-size:${p.getPropertyValue("font-size")};`,`font-family:${p.getPropertyValue("font-family")};`,`font-weight:${p.getPropertyValue("font-weight")};`,`opacity:${p.getPropertyValue("opacity")};`],T=l.getAttribute("style")||"";l.setAttribute("style",`${T}${y.join("")}`)});const oe=new XMLSerializer().serializeToString(_),fe=new Blob([oe],{type:"image/svg+xml;charset=utf-8"}),V=URL.createObjectURL(fe),W=new Image;W.onload=()=>{const f=document.createElement("canvas");f.width=b,f.height=g;const v=f.getContext("2d");if(!v){URL.revokeObjectURL(V),o(null);return}v.fillStyle="#ffffff",v.fillRect(0,0,b,g),v.drawImage(W,0,0,b,g),URL.revokeObjectURL(V),o(f.toDataURL("image/png"))},W.onerror=()=>{URL.revokeObjectURL(V),o(null)},W.src=V}),J=async(a,o)=>{const c=await Z(a);if(!c)return;const m=document.createElement("a");m.href=c,m.download=`${o}.png`,m.click()},ke=async(a,o)=>{const c=await Z(a);if(!c)return;const m=window.open("","_blank");m&&(m.document.write(`
      <html>
        <head>
          <title>${o}</title>
          <style>body{font-family:Arial;padding:16px;text-align:center;}img{max-width:100%;}</style>
        </head>
        <body>
          <h3>${o}</h3>
          <img id="chart-image" src="${c}" alt="${o}" />
          <script>
            const img = document.getElementById('chart-image');
            img.onload = () => { window.print(); };
          <\/script>
        </body>
      </html>
    `),m.document.close())},Ce=()=>{const a=[[{type:"String",value:"Data"},{type:"String",value:"Receitas"},{type:"String",value:"Despesas"},{type:"String",value:"Saldo do Dia"},{type:"String",value:"Saldo Acumulado"},{type:"String",value:"Saldo Banco"}],...ve.map(g=>[{type:"String",value:g.data.toLocaleDateString("pt-BR")},{type:"Number",value:Number(g.totalReceitasPrevistas||0)},{type:"Number",value:Number(g.totalDespesasPrevistas||0)},{type:"Number",value:Number(g.saldoPrevistoDia||0)},{type:"Number",value:Number(g.saldoAcumulado||0)},{type:"Number",value:Number(g.saldoBanco||0)}])],o=G("Fluxo Previsto (período)",a),c=new Blob([o],{type:"application/xml;charset=utf-8;"}),m=URL.createObjectURL(c),b=document.createElement("a");b.href=m,b.download=`fluxo-previsto-periodo-${L(j)}-${L(S)}.xml`,b.click(),URL.revokeObjectURL(m)},_e=()=>{const a=ve.map(c=>`
      <tr>
        <td>${c.data.toLocaleDateString("pt-BR")}</td>
        <td>${N(c.totalReceitasPrevistas)}</td>
        <td>${N(c.totalDespesasPrevistas)}</td>
        <td>${N(c.saldoPrevistoDia)}</td>
        <td>${N(c.saldoAcumulado)}</td>
        <td>${N(c.saldoBanco||0)}</td>
      </tr>
    `).join(""),o=window.open("","_blank");o&&(o.document.write(`
      <html><head><title>Fluxo Previsto (período)</title>
      <style>table{border-collapse:collapse;width:100%;font-family:Arial;}th,td{border:1px solid #ddd;padding:6px;font-size:12px;}th{background:#f3f4f6;text-align:left;}</style>
      </head><body>
      <h3>Fluxo Previsto (período)</h3>
      <table><thead><tr><th>Data</th><th>Receitas</th><th>Despesas</th><th>Saldo do Dia</th><th>Saldo Acumulado</th><th>Saldo Banco</th></tr></thead>
      <tbody>${a}</tbody>
      </table>
      </body></html>
    `),o.document.close(),o.print())},mt=()=>{const a=[[{type:"String",value:"Competência"},{type:"String",value:"Receitas"},{type:"String",value:"Despesas"},{type:"String",value:"Saldo"},{type:"String",value:"Saldo Acumulado"},{type:"String",value:"Saldo Banco"}],...Ne.map(g=>[{type:"String",value:`${String(g.mes).padStart(2,"0")}/${g.ano}`},{type:"Number",value:Number(g.totalReceitasPrevistas||0)},{type:"Number",value:Number(g.totalDespesasPrevistas||0)},{type:"Number",value:Number(g.saldoPrevistoMes||0)},{type:"Number",value:Number(g.saldoAcumulado||0)},{type:"Number",value:Number(g.saldoBanco||0)}])],o=G("Fluxo Previsto (mensal)",a),c=new Blob([o],{type:"application/xml;charset=utf-8;"}),m=URL.createObjectURL(c),b=document.createElement("a");b.href=m,b.download=`fluxo-previsto-mensal-${L(j)}-${L(S)}.xml`,b.click(),URL.revokeObjectURL(m)},pt=()=>{const a=Ne.map(c=>`
      <tr>
        <td>${String(c.mes).padStart(2,"0")}/${c.ano}</td>
        <td>${N(c.totalReceitasPrevistas)}</td>
        <td>${N(c.totalDespesasPrevistas)}</td>
        <td>${N(c.saldoPrevistoMes)}</td>
        <td>${N(c.saldoAcumulado)}</td>
        <td>${N(c.saldoBanco||0)}</td>
      </tr>
    `).join(""),o=window.open("","_blank");o&&(o.document.write(`
      <html><head><title>Fluxo Previsto (mensal)</title>
      <style>table{border-collapse:collapse;width:100%;font-family:Arial;}th,td{border:1px solid #ddd;padding:6px;font-size:12px;}th{background:#f3f4f6;text-align:left;}</style>
      </head><body>
      <h3>Fluxo Previsto (mensal)</h3>
      <table><thead><tr><th>Competência</th><th>Receitas</th><th>Despesas</th><th>Saldo</th><th>Saldo Acumulado</th><th>Saldo Banco</th></tr></thead>
      <tbody>${a}</tbody>
      </table>
      </body></html>
    `),o.document.close(),o.print())},se=A.useMemo(()=>u.reduce((a,o)=>{const c=o.current_balance??o.initial_balance??0,m=typeof c=="string"?Number(c.replace(",",".")):c;return a+(isNaN(m)?0:m)},0),[u]),be=A.useMemo(()=>E.filter(a=>k(a.data_competencia)).reduce((a,o)=>a+(o.valor_liquido||o.valor_bruto||0),0),[E,j,S]),Te=A.useMemo(()=>O.filter(a=>k(a.data_competencia)).reduce((a,o)=>a+(o.valor||0),0),[O,j,S]),ze=A.useMemo(()=>{const a=new Map;return E.forEach(o=>{const c=o.data_competencia;if(!c||!k(c))return;const m=new Date(c),b=`${m.getFullYear()}-${String(m.getMonth()+1).padStart(2,"0")}`,g=a.get(b)||{date:b,receitas:0,despesas:0,resultado:0};g.receitas+=Number(o.valor_liquido||o.valor_bruto||o.valor||0),a.set(b,g)}),O.forEach(o=>{const c=o.data_competencia;if(!c||!k(c))return;const m=new Date(c),b=`${m.getFullYear()}-${String(m.getMonth()+1).padStart(2,"0")}`,g=a.get(b)||{date:b,receitas:0,despesas:0,resultado:0};g.despesas+=Number(o.valor||0),a.set(b,g)}),Array.from(a.values()).map(o=>({...o,resultado:o.receitas-o.despesas})).sort((o,c)=>o.date.localeCompare(c.date))},[E,O,j,S]),ee=A.useMemo(()=>D.filter(a=>k(a.dataPrevista)),[D,j,S]),ne=A.useMemo(()=>{const a=ta(ee),o=new Map;a.forEach(m=>{const b=m.data.toISOString().split("T")[0];o.set(b,m)});const c=new Date;if(c.setHours(0,0,0,0),c>=j&&c<=S){const m=c.toISOString().split("T")[0];o.has(m)||o.set(m,{data:c,totalReceitasPrevistas:0,totalDespesasPrevistas:0,saldoPrevistoDia:0})}return Array.from(o.values()).sort((m,b)=>m.data.getTime()-b.data.getTime())},[ee,j,S]),He=A.useMemo(()=>it(ne,0),[ne]),Ke=A.useMemo(()=>{if(!ne.length)return se;const a=new Date;if(a.setHours(0,0,0,0),a<j||a>S)return se;const o=ne.reduce((c,m)=>m.data<=a?c+m.saldoPrevistoDia:c,0);return se-o},[ne,se,j,S]),me=A.useMemo(()=>it(ne,Ke),[ne,Ke]),ve=A.useMemo(()=>He.map((a,o)=>({...a,saldoBanco:me[o]?.saldoAcumulado??a.saldoAcumulado})),[He,me]),ht=A.useMemo(()=>ee.filter(a=>a.tipo==="RECEITA").reduce((a,o)=>a+o.valor,0),[ee]),ft=A.useMemo(()=>ee.filter(a=>a.tipo==="DESPESA").reduce((a,o)=>a+o.valor,0),[ee]),We=A.useMemo(()=>aa(ee),[ee]),qe=A.useMemo(()=>{let a=0;return We.map(o=>(a+=o.saldoPrevistoMes,{...o,saldoAcumulado:a}))},[We]),Ne=A.useMemo(()=>qe.map(a=>({...a,saldoBanco:se+a.saldoAcumulado})),[qe,se]),De=a=>{const o=new Date;if(a==="today")C(new Date(o.getFullYear(),o.getMonth(),o.getDate())),M(new Date(o.getFullYear(),o.getMonth(),o.getDate()));else if(a==="week"){const c=new Date(o),m=new Date(o);m.setDate(m.getDate()+6),C(c),M(m)}else a==="month"?(C(new Date(o.getFullYear(),o.getMonth(),1)),M(new Date(o.getFullYear(),o.getMonth()+1,0))):(C(new Date(o.getFullYear(),0,1)),M(new Date(o.getFullYear(),11,31)))},Ye=a=>{ie(a),s.set("tab",a),i(s)};return h?e.jsxs("div",{className:"flex flex-col items-center justify-center h-96 text-gray-400",children:[e.jsx(vt,{size:48,className:"animate-spin mb-4 text-brand-500"}),e.jsx("p",{children:"Carregando indicadores financeiros..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Visão Geral"}),e.jsx("p",{className:"text-gray-500",children:"Resumo financeiro em tempo real"})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("button",{onClick:()=>Ye("dre"),className:`px-4 py-2 text-sm rounded-lg border ${U==="dre"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"DRE"}),e.jsx("button",{onClick:()=>Ye("caixa"),className:`px-4 py-2 text-sm rounded-lg border ${U==="caixa"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Fluxo de Caixa"})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex flex-col md:flex-row md:items-center gap-3",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx("button",{onClick:()=>De("today"),className:"px-3 py-2 text-sm border border-gray-200 rounded-lg hover:bg-gray-50",children:"Dia"}),e.jsx("button",{onClick:()=>De("week"),className:"px-3 py-2 text-sm border border-gray-200 rounded-lg hover:bg-gray-50",children:"Semana"}),e.jsx("button",{onClick:()=>De("month"),className:"px-3 py-2 text-sm border border-gray-200 rounded-lg hover:bg-gray-50",children:"Mês"}),e.jsx("button",{onClick:()=>De("year"),className:"px-3 py-2 text-sm border border-gray-200 rounded-lg hover:bg-gray-50",children:"Ano"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Qe,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"date",value:L(j),onChange:a=>{const o=q(a.target.value);o&&C(o)},className:"pl-9 pr-3 py-2 border border-gray-200 rounded-lg text-sm focus:ring-brand-500 focus:border-brand-500"})]}),e.jsx("span",{className:"text-gray-400",children:"até"}),e.jsxs("div",{className:"relative",children:[e.jsx(Qe,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"date",value:L(S),onChange:a=>{const o=q(a.target.value);o&&M(o)},className:"pl-9 pr-3 py-2 border border-gray-200 rounded-lg text-sm focus:ring-brand-500 focus:border-brand-500"})]})]})]}),U==="dre"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 mb-1",children:"Saldo em Contas"}),e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:N(se)})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center text-blue-600",children:e.jsx(bt,{size:24})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 mb-1",children:"Total Receitas (competência)"}),e.jsx("h3",{className:"text-2xl font-bold text-green-600",children:N(be)})]}),e.jsx("div",{className:"w-12 h-12 bg-green-50 rounded-full flex items-center justify-center text-green-600",children:e.jsx(It,{size:24})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 mb-1",children:"Total Despesas (competência)"}),e.jsx("h3",{className:"text-2xl font-bold text-red-600",children:N(Te)})]}),e.jsx("div",{className:"w-12 h-12 bg-red-50 rounded-full flex items-center justify-center text-red-600",children:e.jsx(Tt,{size:24})})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"DRE (competência)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg border border-gray-100 bg-green-50",children:[e.jsx("p",{className:"text-xs uppercase text-gray-600",children:"Receitas"}),e.jsx("p",{className:"text-xl font-bold text-green-700",children:N(be)})]}),e.jsxs("div",{className:"p-4 rounded-lg border border-gray-100 bg-red-50",children:[e.jsx("p",{className:"text-xs uppercase text-gray-600",children:"Despesas"}),e.jsx("p",{className:"text-xl font-bold text-red-700",children:N(Te)})]}),e.jsxs("div",{className:"p-4 rounded-lg border border-gray-100 bg-blue-50",children:[e.jsx("p",{className:"text-xs uppercase text-gray-600",children:"Resultado"}),e.jsx("p",{className:"text-xl font-bold text-blue-700",children:N(be-Te)})]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"DRE (competência) • Entradas x Despesas"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>J(Q.current,"dre-competencia"),className:"px-3 py-2 text-sm border border-gray-200 rounded-lg text-gray-700 hover:bg-gray-50",children:"PNG"}),e.jsx("button",{type:"button",onClick:()=>ke(Q.current,"DRE (competência)"),className:"px-3 py-2 text-sm border border-gray-200 rounded-lg text-gray-700 hover:bg-gray-50",children:"PDF"})]})]}),e.jsx("div",{className:"h-80",ref:Q,children:ze.length>0?e.jsx(Je,{width:"100%",height:"100%",children:e.jsxs(tt,{data:ze,children:[e.jsx(Be,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(Ee,{dataKey:"date",tick:{fill:"#94a3b8",fontSize:12},tickFormatter:Me}),e.jsx(Re,{tick:{fill:"#94a3b8",fontSize:12},tickFormatter:a=>`R$${(a/1e3).toFixed(1)}k`}),e.jsx(Fe,{formatter:a=>N(a),labelFormatter:a=>`Mês: ${Me(a)}`}),e.jsx(Se,{dataKey:"receitas",name:"Entradas",fill:"#22c55e",radius:[6,6,0,0]}),e.jsx(Se,{dataKey:"despesas",name:"Despesas",fill:"#ef4444",radius:[6,6,0,0]}),e.jsx(Se,{dataKey:"resultado",name:"Resultado",fill:"#3b82f6",radius:[6,6,0,0]})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-gray-400 text-sm",children:"Sem dados para o período selecionado."})})]})]}),U==="caixa"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-100",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Faturamento emitido (mês)"}),e.jsx("p",{className:"text-xl font-bold text-gray-800",children:N(be)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-100",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Recebimento previsto caixa  (filtro)"}),e.jsx("p",{className:"text-xl font-bold text-green-600",children:N(ht)})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-100",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Pagamento previsto caixa (mês)"}),e.jsx("p",{className:"text-xl font-bold text-red-600",children:N(ft)})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Fluxo de Caixa (Saldo Previsto)+ Saldo Banco "}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>X("linha"),className:`px-3 py-2 text-sm border rounded-lg ${Y==="linha"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Linha"}),e.jsx("button",{type:"button",onClick:()=>X("coluna"),className:`px-3 py-2 text-sm border rounded-lg ${Y==="coluna"?"bg-brand-600 text-white border-brand-600":"bg-white text-gray-700 border-gray-200"}`,children:"Coluna"})]})]}),e.jsx("div",{className:"h-72",children:me.length>0?e.jsx(Je,{width:"100%",height:"100%",children:Y==="linha"?e.jsxs(Qt,{data:me.map(a=>({data:a.data.toISOString().split("T")[0],saldo:a.saldoAcumulado})),children:[e.jsx(Be,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(Ee,{dataKey:"data",tick:{fill:"#94a3b8",fontSize:12},tickFormatter:Ae}),e.jsx(Re,{tick:{fill:"#94a3b8",fontSize:12},tickFormatter:a=>`R$${(a/1e3).toFixed(1)}k`}),e.jsx(Fe,{formatter:a=>N(a),labelFormatter:a=>Ae(a)}),e.jsx(et,{y:0,stroke:"#ef4444",strokeDasharray:"4 4"}),e.jsx(ye,{type:"linear",dataKey:"saldo",stroke:"#0ea5e9",strokeWidth:2,dot:!1})]}):e.jsxs(tt,{data:me.map(a=>({data:a.data.toISOString().split("T")[0],saldo:a.saldoAcumulado})),children:[e.jsx(Be,{strokeDasharray:"3 3",vertical:!1,stroke:"#f1f5f9"}),e.jsx(Ee,{dataKey:"data",tick:{fill:"#94a3b8",fontSize:12},tickFormatter:Ae}),e.jsx(Re,{tick:{fill:"#94a3b8",fontSize:12},tickFormatter:a=>`R$${(a/1e3).toFixed(1)}k`}),e.jsx(Fe,{formatter:a=>N(a),labelFormatter:a=>Ae(a)}),e.jsx(et,{y:0,stroke:"#ef4444",strokeDasharray:"4 4"}),e.jsx(Se,{dataKey:"saldo",name:"Saldo",fill:"#0ea5e9",radius:[6,6,0,0]})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-gray-400 text-sm",children:"Nenhuma previsão no período."})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Fluxo Previsto (mensal)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:mt,className:"px-3 py-2 text-sm border border-gray-200 rounded-lg text-gray-700 hover:bg-gray-50",children:"Excel"}),e.jsx("button",{type:"button",onClick:pt,className:"px-3 py-2 text-sm border border-gray-200 rounded-lg text-gray-700 hover:bg-gray-50",children:"PDF"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500 border-b border-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Competência"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Receitas"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Despesas"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Saldo"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Saldo Acumulado"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Saldo Banco"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[Ne.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 text-gray-700",children:Me(`${a.ano}-${String(a.mes).padStart(2,"0")}`)}),e.jsx("td",{className:"px-4 py-2 text-right text-green-600 font-medium",children:N(a.totalReceitasPrevistas)}),e.jsx("td",{className:"px-4 py-2 text-right text-red-600 font-medium",children:N(a.totalDespesasPrevistas)}),e.jsx("td",{className:"px-4 py-2 text-right font-semibold",children:N(a.saldoPrevistoMes)}),e.jsx("td",{className:"px-4 py-2 text-right font-semibold",children:N(a.saldoAcumulado)}),e.jsx("td",{className:"px-4 py-2 text-right font-semibold",children:N(a.saldoBanco||0)})]},`${a.ano}-${a.mes}`)),Ne.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-4 text-gray-400",children:"Sem previsões mensais."})})]})]})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Fluxo Previsto (período)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:Ce,className:"px-3 py-2 text-sm border border-gray-200 rounded-lg text-gray-700 hover:bg-gray-50",children:"Excel"}),e.jsx("button",{type:"button",onClick:_e,className:"px-3 py-2 text-sm border border-gray-200 rounded-lg text-gray-700 hover:bg-gray-50",children:"PDF"})]})]}),e.jsx("div",{className:"overflow-x-auto max-h-96 overflow-y-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500 border-b border-gray-100 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Data"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Receitas"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Despesas"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Saldo do Dia"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Saldo Acumulado"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Saldo Banco"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[ve.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2 text-gray-700",children:a.data.toLocaleDateString("pt-BR")}),e.jsx("td",{className:"px-4 py-2 text-right text-green-600 font-medium",children:N(a.totalReceitasPrevistas)}),e.jsx("td",{className:"px-4 py-2 text-right text-red-600 font-medium",children:N(a.totalDespesasPrevistas)}),e.jsx("td",{className:"px-4 py-2 text-right font-semibold",children:N(a.saldoPrevistoDia)}),e.jsx("td",{className:"px-4 py-2 text-right font-semibold",children:N(a.saldoAcumulado)}),e.jsx("td",{className:"px-4 py-2 text-right font-semibold",children:N(a.saldoBanco||0)})]},a.data.toString())),ve.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-4 text-gray-400",children:"Sem previsões registradas."})})]})]})})]})]})]})};export{ca as default};
