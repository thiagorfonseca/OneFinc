import{r as n,j as a,P as Z,s as c}from"./index-D0iWI1-0.js";import{P as z}from"./plus-XBhS4Bhv.js";import{X as ee}from"./x-tPIWqqHD.js";import{L as ae}from"./loader-2-FHfyU3Jl.js";const C=[{value:"/",label:"Dash Financeiro"},{value:"/incomes",label:"Receitas"},{value:"/expenses",label:"Despesas"},{value:"/card-analysis",label:"Análise de cartão"},{value:"/reconciliation",label:"Conciliação bancária"},{value:"/profile",label:"Meu perfil"},{value:"/assistant",label:"Assistente AI"},{value:"/contents/courses",label:"Conteúdos • Cursos"},{value:"/contents/trainings",label:"Conteúdos • Treinamentos"},{value:"/accounts",label:"Contas bancárias"},{value:"/settings",label:"Minha Clínica"},{value:"/settings?section=geral",label:"Minha Clínica • Informações gerais"},{value:"/settings?section=categorias",label:"Minha Clínica • Categorias"},{value:"/settings?section=taxas",label:"Minha Clínica • Taxas"},{value:"/settings?section=clientes",label:"Minha Clínica • Clientes"},{value:"/settings?section=procedimentos",label:"Minha Clínica • Procedimentos"},{value:"/settings?section=profissionais",label:"Minha Clínica • Profissionais"},{value:"/settings?section=fornecedores",label:"Minha Clínica • Fornecedores"},{value:"/settings?section=usuarios",label:"Minha Clínica • Usuários"},{value:"/commercial/dashboard",label:"Comercial • Dash comercial"},{value:"/commercial/ranking",label:"Comercial • Ranking dos clientes"},{value:"/commercial/recurrence",label:"Comercial • Recorrência"},{value:"/commercial/geo",label:"Comercial • Geolocalização"},{value:"/pricing/calculator",label:"Precificação • Calculadora"},{value:"/pricing/procedures",label:"Precificação • Procedimentos"},{value:"/pricing/expenses",label:"Precificação • Gastos"},{value:"/pricing/focus-matrix",label:"Precificação • Matriz de Foco"},{value:"/hr/departments",label:"Minha Clínica • Departamentos"},{value:"/hr/collaborators",label:"Minha Clínica • Colaboradores"},{value:"/hr/feedback",label:"Recursos Humanos • Feedback"},{value:"/hr/meetings",label:"Recursos Humanos • Reuniões"},{value:"/hr/archetypes",label:"Recursos Humanos • Arquétipos"},{value:"/hr/values",label:"Recursos Humanos • Teoria de valores"},{value:"/analytics/perfil",label:"Analytics • Perfil comportamental"}],k={name:"",description:"",pages:[],courseIds:[],trainingIds:[]},ne=()=>{const[x,R]=n.useState([]),[D,y]=n.useState({}),[w,q]=n.useState([]),[P,T]=n.useState([]),[F,L]=n.useState([]),[v,_]=n.useState(!0),[I,S]=n.useState(!1),[H,p]=n.useState(!1),[h,j]=n.useState(null),[d,l]=n.useState(k),[E,u]=n.useState(null),[g,O]=n.useState(""),[f,b]=n.useState(""),[M,A]=n.useState(!1),G=n.useMemo(()=>Object.fromEntries(C.map(e=>[e.value,e.label])),[]),N=async()=>{const{data:e,error:s}=await c.from("content_packages").select("*").order("created_at",{ascending:!1});if(s)throw s;R(e||[])},B=async e=>{if(!e.length){y({});return}const{data:s,error:r}=await c.from("content_package_items").select("package_id, content_items (id, type)").in("package_id",e);if(r)throw r;const t={};(s||[]).forEach(i=>{const o=i.package_id,m=i.content_items;!o||!m||(t[o]||(t[o]={courses:0,trainings:0}),m.type==="course"&&(t[o].courses+=1),m.type==="training"&&(t[o].trainings+=1))}),y(t)},U=async()=>{const{data:e,error:s}=await c.from("content_items").select("id, title, type, published").order("title",{ascending:!0});if(s)throw s;const r=e||[];q(r.filter(t=>t.type==="course")),T(r.filter(t=>t.type==="training"))},X=async()=>{const{data:e,error:s}=await c.from("clinics").select("id, name").order("name",{ascending:!0});if(s)throw s;L(e||[])},$=async e=>{if(!e){b("");return}const{data:s,error:r}=await c.from("clinic_packages").select("package_id").eq("clinic_id",e);if(r)throw r;const t=(s||[]).map(i=>i.package_id).filter(Boolean)[0]||"";b(t)},J=async()=>{_(!0),u(null);try{await Promise.all([N(),U(),X()])}catch(e){u(e.message||"Erro ao carregar pacotes.")}finally{_(!1)}};n.useEffect(()=>{J()},[]),n.useEffect(()=>{const e=x.map(s=>s.id).filter(Boolean);B(e).catch(()=>y({}))},[x]),n.useEffect(()=>{g&&$(g).catch(()=>b(""))},[g]);const K=()=>{j(null),l(k),p(!0)},Q=async e=>{j(e.id),l({name:e.name||"",description:e.description||"",pages:e.pages||[],courseIds:[],trainingIds:[]}),p(!0);try{const{data:s,error:r}=await c.from("content_package_items").select("content_items (id, type)").eq("package_id",e.id);if(r)throw r;const t=[],i=[];(s||[]).forEach(o=>{const m=o.content_items;m&&(m.type==="course"&&t.push(m.id),m.type==="training"&&i.push(m.id))}),l(o=>({...o,courseIds:t,trainingIds:i}))}catch(s){u(s.message||"Erro ao carregar itens do pacote.")}},V=async e=>{if(e.preventDefault(),!d.name.trim()){u("Informe o nome do pacote.");return}S(!0),u(null);try{const s={name:d.name.trim(),description:d.description.trim(),pages:d.pages};let r=h;if(h){const{error:t}=await c.from("content_packages").update(s).eq("id",h);if(t)throw t}else{const{data:t,error:i}=await c.from("content_packages").insert([s]).select().single();if(i)throw i;r=t?.id}if(r){await c.from("content_package_items").delete().eq("package_id",r);const t=Array.from(new Set([...d.courseIds,...d.trainingIds]));if(t.length){const i=t.map(m=>({package_id:r,content_id:m})),{error:o}=await c.from("content_package_items").insert(i);if(o)throw o}}p(!1),j(null),l(k),await N()}catch(s){u(s.message||"Erro ao salvar pacote.")}finally{S(!1)}},W=async e=>{if(!confirm(`Excluir o pacote "${e.name}"?`))return;const{error:s}=await c.from("content_packages").delete().eq("id",e.id);if(s){u(s.message);return}N()},Y=async()=>{if(g){A(!0);try{if(await c.from("clinic_packages").delete().eq("clinic_id",g),f){const{error:e}=await c.from("clinic_packages").insert([{clinic_id:g,package_id:f}]);if(e)throw e}alert("Pacotes atualizados para a clínica.")}catch(e){u(e.message||"Erro ao salvar pacotes da clínica.")}finally{A(!1)}}};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Pacotes"}),a.jsx("p",{className:"text-gray-500",children:"Defina cursos, treinamentos e páginas para cada pacote."})]}),a.jsxs("button",{type:"button",onClick:K,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 flex items-center gap-2",children:[a.jsx(z,{size:16}),"Adicionar pacote"]})]}),E&&a.jsx("div",{className:"bg-white border border-red-100 rounded-xl p-4 text-sm text-red-600",children:E}),a.jsxs("div",{className:"bg-white border border-gray-100 rounded-xl shadow-sm p-6 space-y-4",children:[a.jsxs("h2",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[a.jsx(Z,{size:16})," Atribuir pacotes à clínica"]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Clínica"}),a.jsxs("select",{value:g,onChange:e=>O(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none bg-white",children:[a.jsx("option",{value:"",children:"Selecione..."}),F.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pacotes liberados"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[a.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 border border-gray-200 rounded-lg px-2 py-1",children:[a.jsx("input",{type:"radio",name:"clinicPackage",checked:!f,onChange:()=>b("")}),"Sem pacote"]}),x.map(e=>{const s=f===e.id;return a.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 border border-gray-200 rounded-lg px-2 py-1",children:[a.jsx("input",{type:"radio",name:"clinicPackage",checked:s,onChange:()=>b(e.id)}),e.name]},e.id)}),x.length===0&&a.jsx("p",{className:"text-sm text-gray-400",children:"Nenhum pacote cadastrado."})]})]})]}),a.jsx("div",{className:"flex justify-end",children:a.jsx("button",{type:"button",disabled:!g||M,onClick:Y,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50",children:M?"Salvando...":"Salvar pacotes"})})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[v&&a.jsx("div",{className:"text-sm text-gray-400",children:"Carregando pacotes..."}),!v&&x.length===0&&a.jsx("div",{className:"text-sm text-gray-400",children:"Nenhum pacote cadastrado."}),!v&&x.map(e=>{const s=D[e.id]||{courses:0,trainings:0};return a.jsxs("div",{className:"bg-white border border-gray-100 rounded-xl shadow-sm p-5 space-y-3",children:[a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:e.name}),e.description&&a.jsx("p",{className:"text-sm text-gray-500",children:e.description})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>Q(e),className:"text-sm text-brand-600",children:"Editar"}),a.jsx("button",{onClick:()=>W(e),className:"text-sm text-red-600",children:"Excluir"})]})]}),a.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-gray-600",children:[a.jsxs("span",{className:"px-2 py-1 rounded-full bg-slate-100",children:["Cursos: ",s.courses]}),a.jsxs("span",{className:"px-2 py-1 rounded-full bg-slate-100",children:["Treinamentos: ",s.trainings]}),a.jsxs("span",{className:"px-2 py-1 rounded-full bg-slate-100",children:["Páginas: ",e.pages?.length||0]})]}),e.pages?.length>0&&a.jsx("p",{className:"text-xs text-gray-500",children:e.pages.map(r=>G[r]||r).join(", ")})]},e.id)})]}),H&&a.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-6 w-full max-w-2xl space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:h?"Editar pacote":"Novo pacote"}),a.jsx("button",{onClick:()=>p(!1),className:"text-gray-500 hover:text-gray-700",children:a.jsx(ee,{size:18})})]}),a.jsxs("form",{onSubmit:V,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),a.jsx("input",{value:d.name,onChange:e=>l(s=>({...s,name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descrição"}),a.jsx("textarea",{value:d.description,onChange:e=>l(s=>({...s,description:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-brand-500 outline-none",rows:3})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cursos inclusos"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 max-h-48 overflow-auto border border-gray-100 rounded-lg p-2",children:[w.map(e=>{const s=d.courseIds.includes(e.id);return a.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700",children:[a.jsx("input",{type:"checkbox",checked:s,onChange:r=>{r.target.checked?l(t=>({...t,courseIds:[...t.courseIds,e.id]})):l(t=>({...t,courseIds:t.courseIds.filter(i=>i!==e.id)}))}}),e.title||"Sem título"]},e.id)}),w.length===0&&a.jsx("p",{className:"text-sm text-gray-400",children:"Nenhum curso cadastrado."})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Treinamentos inclusos"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 max-h-48 overflow-auto border border-gray-100 rounded-lg p-2",children:[P.map(e=>{const s=d.trainingIds.includes(e.id);return a.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700",children:[a.jsx("input",{type:"checkbox",checked:s,onChange:r=>{r.target.checked?l(t=>({...t,trainingIds:[...t.trainingIds,e.id]})):l(t=>({...t,trainingIds:t.trainingIds.filter(i=>i!==e.id)}))}}),e.title||"Sem título"]},e.id)}),P.length===0&&a.jsx("p",{className:"text-sm text-gray-400",children:"Nenhum treinamento cadastrado."})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Páginas inclusas"}),a.jsxs("div",{className:"flex gap-2 mb-2",children:[a.jsx("button",{type:"button",onClick:()=>l(e=>({...e,pages:C.map(s=>s.value)})),className:"px-2 py-1 text-xs bg-emerald-50 text-emerald-700 rounded border border-emerald-100",children:"Selecionar tudo"}),a.jsx("button",{type:"button",onClick:()=>l(e=>({...e,pages:[]})),className:"px-2 py-1 text-xs bg-red-50 text-red-700 rounded border border-red-100",children:"Limpar"})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 max-h-48 overflow-auto border border-gray-100 rounded-lg p-2",children:C.map(e=>{const s=d.pages.includes(e.value);return a.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700",children:[a.jsx("input",{type:"checkbox",checked:s,onChange:r=>{r.target.checked?l(t=>({...t,pages:[...t.pages,e.value]})):l(t=>({...t,pages:t.pages.filter(i=>i!==e.value)}))}}),e.label]},e.value)})})]}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx("button",{type:"button",onClick:()=>p(!1),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg",children:"Cancelar"}),a.jsxs("button",{type:"submit",disabled:I,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50 flex items-center gap-2",children:[I?a.jsx(ae,{size:16,className:"animate-spin"}):a.jsx(z,{size:16}),h?"Salvar":"Adicionar"]})]})]})]})})]})};export{ne as default};
