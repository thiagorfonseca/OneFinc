import{j as e,i as q,d as z,r as i}from"./index-D0iWI1-0.js";import{r as J,s as X}from"./archetypeService-mUGP5OAI.js";const M=["FACILITADOR","ANALISTA","REALIZADOR","VISIONÁRIO"],R=[["ATENCIOSO","CONTROLADO","ENERGÉTICO","SOCIÁVEL"],["DOADOR","SUBMISSO","COMPETITIVO","CONVINCENTE"],["RESPEITOSO","RESERVADO","HABILIDOSO","ESTIMULANTE"],["SENSÍVEL","SATISFEITO","AUTOSSUFICIENTE","ESPIRITUOSO"],["PACIENTE","PLANEJADOR","POSITIVO","CHARMOSO"],["TÍMIDO","ORGANIZADO","SEGURO","ESPONTÂNEO"],["SERVIÇAL","ORDEIRO","FRANCO","OTIMISTA"],["AMIGÁVEL","FIEL","VIGOROSO","ENGRAÇADO"],["DIPLOMÁTICO","MINUNCIOSO","AUDACIOSO","ENCANTADOR"],["PREVISÍVEL","CULTO","CONFIANTE","ALEGRE"],["INOFENSIVO","IDEALISTA","INDEPENDENTE","INSPIRADO"],["PROFUNDO","DEMONSTRATIVO","DECIDIDO","IRÔNICO"],["MEDIADOR","DESEMBARAÇADO","ATIVO","MUSICAL"],["TOLERANTE","PENSATIVO","FIRME","CONVERSADOR"],["LEAL","OUVINTE","LÍDER","ATIVO"],["CONTENTE","DETALHISTA","CHEFE","ATRAENTE"],["AGRADÁVEL","PERFECCIONISTA","PRODUTIVO","POPULAR"],["EQUILIBRADO","COMPORTADO","VALENTE","VIVAZ"],["ACANHADO","TRANQUILO","AUTORITARIO","METIDO"],["COMPREENSIVO","DISCIPLINADO","ARROJADO","SEQUESTRADOR"],["DÓCIL","TÉCNICO","DESTEMIDO","EXIBIDO"],["EXPERIENTE","INVESTIGADOR","PIONEIRO","EXPRESSIVO"],["CONSIDERADO","COERENTE","VIGILANTE","INVENTIVO"],["FIEL","SENSATO","OTIMISTA","ENTUSIASMADO"],["CASUAL","RIGOROSO","AMBICIOSO","TALENTOSO"],["COOPERATIVO","PENSADOR","TOMADOR DE DECISÃO","CRÍTICO"],["DIPLOMATA","DESENVOLVIDO","ENFRENTA DESAFIOS","CRIATIVO"],["PACIENTE","DESCONFIADO","INQUIETO","AVENTUREIRO"],["CALMO","EXIGENTE","OBSTINADO","CONQUISTADOR"],["SENSÍVEL","METÓDICO","DESTEMIDO","INOVADOR"],["TRANQUILO","MELANCÓLICO","ORIENTADO","EXTROVERTIDO"],["COMPLACENTE","RACIONAL","AUTOCONFIANTE","IMPULSIVO"],["ACOMODADO","CRÍTICO","ASTUTO","INSTÁVEL"],["VAGAROSO","DESCONFIADO","IRRITÁVEL","DISTRAÍDO"],["VINGATIVO","RELUTANTE","AGITADO","IMPRUDENTE"],["ACOMODADO","CRÍTICO","ASTUTO","INSTÁVEL"],["ANIMADO","ANALÍTICO","AVENTUREIRO","ADAPTÁVEL"],["SERENO","PERSUASIVO","PERSISTENTE","BRINCALHÃO"],["ATENCIOSO","CONTROLADO","ENERGÉTICO","SOCIÁVEL"],["DOADOR","SUBMISSO","COMPETITIVO","CONVINCENTE"]],Z=a=>{const l={FACILITADOR:0,ANALISTA:0,REALIZADOR:0,VISIONÁRIO:0};return a.forEach(c=>{if(c==null)return;const n=M[c];n&&(l[n]+=1)}),l},W=a=>{const l=Object.entries(a),c=Math.max(...l.map(([,o])=>o)),n=l.filter(([,o])=>o===c).map(([o])=>o);return n.length>1?{topProfile:"EMPATE",topProfiles:n}:{topProfile:n[0],topProfiles:n}},Y=(a,l=40)=>{const c=l>0?l:1,n={FACILITADOR:0,ANALISTA:0,REALIZADOR:0,VISIONÁRIO:0};return Object.keys(n).forEach(o=>{n[o]=a[o]/c*100}),n},K=({current:a,total:l,label:c})=>{const n=l>0?l:1,o=Math.min(100,Math.max(0,a/n*100));return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsx("span",{children:c||"Progresso"}),e.jsxs("span",{children:[a,"/",l]})]}),e.jsx("div",{className:"w-full h-2 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-brand-500 rounded-full transition-all",style:{width:`${o}%`}})})]})},ee=({index:a,total:l,options:c,selectedIndex:n,onSelect:o})=>e.jsxs("div",{className:"bg-white border border-gray-100 rounded-2xl p-6 shadow-sm space-y-5",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs uppercase tracking-wide text-gray-400",children:["Pergunta ",a+1," de ",l]}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mt-1",children:"Escolha a palavra que mais combina com você"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:c.map((E,N)=>{const A=n===N;return e.jsx("button",{type:"button",onClick:()=>o(N),className:`text-left px-4 py-3 rounded-xl border transition-all ${A?"border-brand-500 bg-brand-50 text-brand-700 shadow-sm":"border-gray-200 bg-white text-gray-700 hover:border-brand-300 hover:bg-brand-50/40"}`,children:e.jsx("span",{className:"font-medium",children:E})},`${E}-${N}`)})})]}),m=R.length,se=Array.from({length:m},()=>null),te={name:"",email:"",phone:"",profession:"",city:"",consent:!1},ne=()=>{const{publicToken:a}=q(),l=z(),[c,n]=i.useState(!0),[o,E]=i.useState(null),[N,A]=i.useState(!1),[f,y]=i.useState("intro"),[t,I]=i.useState(te),[p,b]=i.useState(se),[O,g]=i.useState(0),[T,x]=i.useState(null),[C,D]=i.useState(!1),u=a?`archetypeDraft:${a}`:"";i.useEffect(()=>{if(!a)return;let s=!0;return(async()=>{n(!0);const d=await J(a);s&&(d?(A(!1),E(d)):(A(!0),E(null)),n(!1))})(),()=>{s=!1}},[a]),i.useEffect(()=>{if(!u)return;const s=typeof window<"u"?window.localStorage.getItem(u):null;if(s)try{const r=JSON.parse(s);if(r?.form&&I(d=>({...d,...r.form})),Array.isArray(r?.answers)&&r.answers.length===m&&b(r.answers),typeof r?.currentIndex=="number"){const d=Math.min(Math.max(r.currentIndex,0),m-1);g(d)}r?.step==="quiz"&&y("quiz")}catch{}},[u]),i.useEffect(()=>{if(!u||typeof window>"u")return;const s={form:t,answers:p,currentIndex:O,step:f};window.localStorage.setItem(u,JSON.stringify(s))},[u,t,p,O,f]);const h=i.useMemo(()=>p.filter(s=>s!==null).length,[p]),j=h===m,U=()=>{if(x(null),!t.name.trim()){x("Informe seu nome para continuar.");return}if(!t.consent){x("Você precisa aceitar a LGPD para continuar.");return}y("quiz")},k=s=>{x(null),b(r=>{const d=[...r];return d[O]=s,d}),O<m-1&&g(r=>r+1)},F=()=>{x(null),g(s=>Math.max(0,s-1))},G=async()=>{if(!(!o||!a)){if(!j){x("Responda todas as perguntas antes de finalizar.");return}D(!0),x(null);try{const s=Z(p),{topProfile:r,topProfiles:d}=W(s),_=Y(s,m),B=p.map((Q,w)=>{const S=Q??0,$=R[w][S],H=M[S];return{questionId:w+1,selectedIndex:S,selectedWord:$,scoredProfile:H}}),L=a.trim(),v=o.clinic_id.trim(),P=o.audience_type?.trim().toUpperCase();if(!L||!v||!P)throw new Error("Token inválido. Atualize a página e tente novamente.");await X({clinic_id:v,public_token:L,audience_type:P,name:t.name.trim(),email:t.email.trim()||null,phone:t.phone.trim()||null,profession:t.profession.trim()||null,city:t.city.trim()||null,consent_lgpd:t.consent,scores:s,top_profile:r,top_profiles:r==="EMPATE"?d:null,answers:B});const V={scores:s,percentages:_,topProfile:r,topProfiles:d};typeof window<"u"&&u&&(window.localStorage.removeItem(u),window.localStorage.setItem(`archetypeResult:${a}`,JSON.stringify(V))),l(`/public/perfil/${a}/resultado`,{state:{result:V}})}catch(s){console.error(s);const r="Não foi possível salvar suas respostas. Tente novamente.";x(s?.message?`${r} (${s.message})`:r)}finally{D(!1)}}};return c?e.jsx("div",{className:"min-h-screen flex items-center justify-center text-gray-500",children:"Carregando..."}):N||!a||!o?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-6",children:e.jsxs("div",{className:"bg-white border border-gray-100 rounded-2xl p-8 max-w-md text-center space-y-3",children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-800",children:"Link inválido ou expirado"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Peça um novo link para acessar o teste de perfil."})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-slate-50 via-white to-slate-50",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-12 space-y-8",children:[e.jsxs("header",{className:"space-y-3 text-center",children:[e.jsx("span",{className:"inline-flex items-center justify-center px-3 py-1 rounded-full bg-brand-50 text-brand-700 text-xs font-semibold uppercase tracking-wide",children:"Questionário comportamental"}),e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-gray-800",children:"Teste de Perfil Comportamental"}),e.jsxs("p",{className:"text-gray-500 max-w-2xl mx-auto",children:["Responda ",m," perguntas para mapear seu estilo de comunicação, decisão e execução. Não existem respostas certas ou erradas."]})]}),f==="intro"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1.2fr_0.8fr] gap-6",children:[e.jsxs("div",{className:"bg-white border border-gray-100 rounded-2xl p-6 space-y-5 shadow-sm",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Antes de começar"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Preencha seus dados básicos e siga para as perguntas."})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex flex-col gap-1 text-sm text-gray-600",children:["Nome *",e.jsx("input",{type:"text",value:t.name,onChange:s=>I({...t,name:s.target.value}),className:"px-3 py-2 border border-gray-200 rounded-lg"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm text-gray-600",children:["Email",e.jsx("input",{type:"email",value:t.email,onChange:s=>I({...t,email:s.target.value}),className:"px-3 py-2 border border-gray-200 rounded-lg"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm text-gray-600",children:["WhatsApp",e.jsx("input",{type:"tel",value:t.phone,onChange:s=>I({...t,phone:s.target.value}),className:"px-3 py-2 border border-gray-200 rounded-lg"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm text-gray-600",children:["Profissão",e.jsx("input",{type:"text",value:t.profession,onChange:s=>I({...t,profession:s.target.value}),className:"px-3 py-2 border border-gray-200 rounded-lg"})]}),e.jsxs("label",{className:"flex flex-col gap-1 text-sm text-gray-600 sm:col-span-2",children:["Cidade",e.jsx("input",{type:"text",value:t.city,onChange:s=>I({...t,city:s.target.value}),className:"px-3 py-2 border border-gray-200 rounded-lg"})]})]}),e.jsxs("label",{className:"flex items-start gap-2 text-sm text-gray-600",children:[e.jsx("input",{type:"checkbox",checked:t.consent,onChange:s=>I({...t,consent:s.target.checked}),className:"mt-1"}),e.jsx("span",{children:"Concordo com o uso dos meus dados conforme a LGPD."})]}),T&&e.jsx("p",{className:"text-sm text-red-500",children:T}),e.jsx("button",{type:"button",onClick:U,className:"px-6 py-3 rounded-xl bg-brand-600 text-white font-medium hover:bg-brand-700",children:"Iniciar teste"})]}),e.jsxs("div",{className:"bg-white border border-gray-100 rounded-2xl p-6 space-y-4 shadow-sm",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide",children:"Como funciona"}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-600",children:[e.jsxs("p",{children:["Você verá ",m," perguntas, cada uma com 4 palavras."]}),e.jsx("p",{children:"Escolha a palavra que mais combina com você no momento."}),e.jsx("p",{children:"O teste leva de 6 a 8 minutos em média."})]}),e.jsx("div",{className:"bg-brand-50 text-brand-700 rounded-xl p-4 text-sm",children:"Suas respostas são usadas apenas para gerar o resultado do perfil comportamental."})]})]}),f==="quiz"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white border border-gray-100 rounded-2xl p-4 shadow-sm",children:e.jsx(K,{current:h,total:m,label:"Respondidas"})}),e.jsx(ee,{index:O,total:m,options:R[O],selectedIndex:p[O],onSelect:k}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3",children:[e.jsx("button",{type:"button",onClick:F,disabled:O===0,className:"px-5 py-2.5 rounded-xl border border-gray-200 text-gray-600 disabled:opacity-50",children:"Voltar"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[h,"/",m," respondidas"]}),e.jsx("button",{type:"button",onClick:G,disabled:!j||C,className:"px-6 py-2.5 rounded-xl bg-brand-600 text-white font-medium disabled:opacity-50",children:C?"Enviando...":"Finalizar teste"})]})]}),T&&e.jsx("p",{className:"text-sm text-red-500",children:T})]})]})})};export{ne as default};
