import{j as e,u as z,r as c}from"./index-D0iWI1-0.js";import{f as M,l as Z,a as $}from"./archetypeService-mUGP5OAI.js";import{b as q}from"./utils-C6qNh0Lg.js";import{R as B}from"./ResultChart-B2HzsEPZ.js";import{u as K}from"./useModalControls-5AW_JpEi.js";import{X as U}from"./x-tPIWqqHD.js";import{R as L,q as O,T as E,n as X,X as W,Y,B as G}from"./generateCategoricalChart-DSct32B6.js";import{P as H,a as J}from"./PieChart-B5dNQpYx.js";import{B as Q}from"./BarChart-BRiZ0XIB.js";import{D as ee}from"./download-Dp9jONEZ.js";const se=({filters:a,tokens:h,onChange:t})=>e.jsxs("div",{className:"bg-white border border-gray-100 rounded-2xl p-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-3",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-xs text-gray-500",children:"De"}),e.jsx("input",{type:"date",value:a.dateFrom,onChange:l=>t({...a,dateFrom:l.target.value}),className:"px-3 py-2 border border-gray-200 rounded-lg text-sm"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-xs text-gray-500",children:"Até"}),e.jsx("input",{type:"date",value:a.dateTo,onChange:l=>t({...a,dateTo:l.target.value}),className:"px-3 py-2 border border-gray-200 rounded-lg text-sm"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-xs text-gray-500",children:"Perfil"}),e.jsxs("select",{value:a.topProfile,onChange:l=>t({...a,topProfile:l.target.value}),className:"px-3 py-2 border border-gray-200 rounded-lg text-sm bg-white",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"FACILITADOR",children:"Facilitador"}),e.jsx("option",{value:"ANALISTA",children:"Analista"}),e.jsx("option",{value:"REALIZADOR",children:"Realizador"}),e.jsx("option",{value:"VISIONÁRIO",children:"Visionário"}),e.jsx("option",{value:"EMPATE",children:"Empate"})]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-xs text-gray-500",children:"Audiência"}),e.jsxs("select",{value:a.audienceType,onChange:l=>t({...a,audienceType:l.target.value}),className:"px-3 py-2 border border-gray-200 rounded-lg text-sm bg-white",children:[e.jsx("option",{value:"",children:"Todas"}),e.jsx("option",{value:"INTERNAL",children:"Interna"}),e.jsx("option",{value:"EXTERNAL",children:"Externa"})]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-xs text-gray-500",children:"Campanha"}),e.jsxs("select",{value:a.token,onChange:l=>t({...a,token:l.target.value}),className:"px-3 py-2 border border-gray-200 rounded-lg text-sm bg-white",children:[e.jsx("option",{value:"",children:"Todas"}),h.map(l=>e.jsx("option",{value:l,children:l},l))]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-xs text-gray-500",children:"Busca"}),e.jsx("input",{type:"text",value:a.search,onChange:l=>t({...a,search:l.target.value}),placeholder:"Nome ou email",className:"px-3 py-2 border border-gray-200 rounded-lg text-sm"})]})]}),ae=({rows:a,onOpenDetails:h})=>e.jsx("div",{className:"bg-white border border-gray-100 rounded-2xl overflow-hidden",children:e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3",children:"Data"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Nome"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Email"}),e.jsx("th",{className:"text-left px-4 py-3",children:"WhatsApp"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Audiência"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Perfil"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Facilitador"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Analista"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Realizador"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Visionário"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Token"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Ações"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[a.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:q(t.created_at)}),e.jsx("td",{className:"px-4 py-3 font-medium text-gray-800",children:t.name}),e.jsx("td",{className:"px-4 py-3",children:t.email||"-"}),e.jsx("td",{className:"px-4 py-3",children:t.phone||"-"}),e.jsx("td",{className:"px-4 py-3",children:t.audience_type==="INTERNAL"?"Interno":"Externo"}),e.jsx("td",{className:"px-4 py-3 font-semibold text-gray-700",children:t.top_profile}),e.jsx("td",{className:"px-4 py-3",children:t.scores?.FACILITADOR??0}),e.jsx("td",{className:"px-4 py-3",children:t.scores?.ANALISTA??0}),e.jsx("td",{className:"px-4 py-3",children:t.scores?.REALIZADOR??0}),e.jsx("td",{className:"px-4 py-3",children:t.scores?.VISIONÁRIO??0}),e.jsx("td",{className:"px-4 py-3",children:t.public_token}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{type:"button",onClick:()=>h(t),className:"px-3 py-1.5 rounded-lg border border-gray-200 text-xs text-gray-700 hover:bg-gray-50",children:"Ver detalhes"})})]},t.id)),a.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"px-4 py-6 text-center text-gray-400",colSpan:12,children:"Nenhum respondente encontrado."})})]})]})})}),te=({open:a,loading:h,onClose:t,respondent:l,answers:j})=>(K({isOpen:a,onClose:t}),a?e.jsxs("div",{className:"fixed inset-0 z-50 flex",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30",onClick:t}),e.jsxs("div",{className:"relative ml-auto w-full max-w-2xl h-full bg-white shadow-xl p-6 overflow-auto",children:[e.jsx("button",{type:"button",onClick:t,className:"absolute top-4 right-4 p-2 rounded-full hover:bg-gray-100",children:e.jsx(U,{size:18})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"Detalhes do respondente"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Resultados individuais e escolhas do teste."})]}),h&&e.jsx("p",{className:"text-sm text-gray-500",children:"Carregando detalhes..."}),!h&&l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-50 border border-gray-100 rounded-xl p-4 grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Nome"}),e.jsx("p",{className:"text-sm font-medium text-gray-800",children:l.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Email"}),e.jsx("p",{className:"text-sm text-gray-700",children:l.email||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:"WhatsApp"}),e.jsx("p",{className:"text-sm text-gray-700",children:l.phone||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Perfil vencedor"}),e.jsx("p",{className:"text-sm font-semibold text-gray-800",children:l.top_profile})]})]}),e.jsx("div",{className:"bg-white border border-gray-100 rounded-xl p-4",children:e.jsx(B,{scores:l.scores})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Respostas"}),e.jsxs("div",{className:"space-y-2",children:[j.slice().sort((m,y)=>m.question_id-y.question_id).map(m=>e.jsxs("div",{className:"flex items-center justify-between border border-gray-100 rounded-lg px-3 py-2 text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Pergunta ",m.question_id]}),e.jsx("span",{className:"font-medium text-gray-800",children:m.selected_word}),e.jsx("span",{className:"text-xs text-gray-500",children:m.scored_profile})]},`${m.respondent_id}-${m.question_id}`)),j.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:"Nenhuma resposta encontrada."})]})]})]})]})]})]}):null),p=a=>`"${String(a).replace(/"/g,'""')}"`,he=()=>{const{effectiveClinicId:a,isSystemAdmin:h}=z(),[t,l]=c.useState(!0),[j,m]=c.useState([]),[y,S]=c.useState([]),[o,C]=c.useState({dateFrom:"",dateTo:"",topProfile:"",audienceType:"",search:"",token:""}),[k,b]=c.useState(!1),[_,v]=c.useState(!1),[F,A]=c.useState(null),[P,I]=c.useState([]),[R,N]=c.useState(null);c.useEffect(()=>{if(!a)return;let s=!0;return(async()=>{l(!0),N(null);try{const[i,d]=await Promise.all([M({clinicId:a}),Z(a)]);if(!s)return;m(i),S(d)}catch(i){console.error(i),s&&N("Não foi possível carregar os dados de analytics.")}finally{s&&l(!1)}})(),()=>{s=!1}},[a]);const x=c.useMemo(()=>{const s=o.search.trim().toLowerCase(),r=o.dateFrom?new Date(`${o.dateFrom}T00:00:00`):null,i=o.dateTo?new Date(`${o.dateTo}T23:59:59`):null;return j.filter(d=>{const u=new Date(d.created_at);return!(r&&u<r||i&&u>i||o.topProfile&&d.top_profile!==o.topProfile||o.audienceType&&d.audience_type!==o.audienceType||o.token&&d.public_token!==o.token||s&&!`${d.name} ${d.email||""}`.toLowerCase().includes(s))})},[j,o]),f=c.useMemo(()=>{const s=new Date,r=new Date;r.setDate(s.getDate()-7);const i=new Date;i.setDate(s.getDate()-30);let d=0,u=0;return x.forEach(g=>{const n=new Date(g.created_at);n>=r&&(d+=1),n>=i&&(u+=1)}),{total:x.length,last7:d,last30:u}},[x]),D=c.useMemo(()=>{const s={FACILITADOR:0,ANALISTA:0,REALIZADOR:0,VISIONÁRIO:0,EMPATE:0};return x.forEach(r=>{s[r.top_profile]=(s[r.top_profile]||0)+1}),[{name:"Facilitador",value:s.FACILITADOR,color:"#22c55e"},{name:"Analista",value:s.ANALISTA,color:"#0ea5e9"},{name:"Realizador",value:s.REALIZADOR,color:"#f97316"},{name:"Visionário",value:s.VISIONÁRIO,color:"#a855f7"},{name:"Empate",value:s.EMPATE,color:"#94a3b8"}]},[x]),T=c.useMemo(()=>{const s={FACILITADOR:0,ANALISTA:0,REALIZADOR:0,VISIONÁRIO:0};x.forEach(i=>{s.FACILITADOR+=i.scores?.FACILITADOR??0,s.ANALISTA+=i.scores?.ANALISTA??0,s.REALIZADOR+=i.scores?.REALIZADOR??0,s.VISIONÁRIO+=i.scores?.VISIONÁRIO??0});const r=x.length||1;return[{name:"Facilitador",value:s.FACILITADOR/r,color:"#22c55e"},{name:"Analista",value:s.ANALISTA/r,color:"#0ea5e9"},{name:"Realizador",value:s.REALIZADOR/r,color:"#f97316"},{name:"Visionário",value:s.VISIONÁRIO/r,color:"#a855f7"}]},[x]),V=()=>{const s=["Data","Nome","Email","WhatsApp","Audiência","Perfil vencedor","Facilitador","Analista","Realizador","Visionário","Token"],r=x.map(n=>[p(n.created_at),p(n.name),p(n.email||""),p(n.phone||""),p(n.audience_type),p(n.top_profile),p(n.scores?.FACILITADOR??0),p(n.scores?.ANALISTA??0),p(n.scores?.REALIZADOR??0),p(n.scores?.VISIONÁRIO??0),p(n.public_token)].join(",")),i=[s.join(","),...r].join(`
`),d=new Blob([i],{type:"text/csv;charset=utf-8;"}),u=URL.createObjectURL(d),g=document.createElement("a");g.href=u,g.download="perfil-analytics.csv",g.click(),URL.revokeObjectURL(u)},w=async s=>{if(a){b(!0),v(!0),A(s),I([]);try{const r=await $(s.id,a);if(!r)return;A(r),I(r.archetype_answers||[])}catch(r){console.error(r),N("Não foi possível carregar os detalhes do respondente.")}finally{v(!1)}}};return t?e.jsx("div",{className:"p-8 text-gray-500",children:"Carregando analytics..."}):a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Arquétipos"}),e.jsx("p",{className:"text-gray-500",children:"Recursos Humanos • Analytics de perfis comportamentais"}),h&&e.jsx("p",{className:"text-xs text-gray-400",children:"Visualizando dados da clínica selecionada."})]}),R&&e.jsx("p",{className:"text-sm text-red-500",children:R}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white border border-gray-100 rounded-2xl p-4",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Total de respostas"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-800",children:f.total})]}),e.jsxs("div",{className:"bg-white border border-gray-100 rounded-2xl p-4",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Últimos 7 dias"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-800",children:f.last7})]}),e.jsxs("div",{className:"bg-white border border-gray-100 rounded-2xl p-4",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Últimos 30 dias"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-800",children:f.last30})]})]}),e.jsx("p",{className:"text-xs text-gray-400",children:"Indicadores e gráficos consideram os filtros aplicados."}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white border border-gray-100 rounded-2xl p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Distribuição do perfil vencedor"}),e.jsx("div",{className:"h-72",children:e.jsx(L,{width:"100%",height:"100%",children:e.jsxs(H,{children:[e.jsx(J,{data:D,dataKey:"value",nameKey:"name",innerRadius:55,outerRadius:90,paddingAngle:3,children:D.map(s=>e.jsx(O,{fill:s.color},s.name))}),e.jsx(E,{formatter:s=>[`${s} respostas`,""]})]})})})]}),e.jsxs("div",{className:"bg-white border border-gray-100 rounded-2xl p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Média de pontuação por perfil"}),e.jsx("div",{className:"h-72",children:e.jsx(L,{width:"100%",height:"100%",children:e.jsxs(Q,{data:T,children:[e.jsx(X,{strokeDasharray:"3 3"}),e.jsx(W,{dataKey:"name",tick:{fontSize:12}}),e.jsx(Y,{allowDecimals:!1}),e.jsx(E,{formatter:s=>[`${s.toFixed(1)} pontos`,"Média"]}),e.jsx(G,{dataKey:"value",radius:[6,6,0,0],children:T.map(s=>e.jsx(O,{fill:s.color},s.name))})]})})})]})]}),e.jsx(se,{filters:o,tokens:y.map(s=>s.token),onChange:C}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:[x.length," respondentes encontrados"]}),e.jsxs("button",{type:"button",onClick:V,className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-gray-200 text-gray-600 hover:bg-gray-50",children:[e.jsx(ee,{size:16}),"Exportar CSV"]})]}),e.jsx(ae,{rows:x,onOpenDetails:w}),e.jsx(te,{open:k,loading:_,onClose:()=>b(!1),respondent:F,answers:P})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Arquétipos"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Selecione uma clínica para visualizar os dados."})]})};export{he as default};
