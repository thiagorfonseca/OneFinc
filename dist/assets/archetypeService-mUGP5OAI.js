import{s as a,q as s}from"./index-D0iWI1-0.js";const p=e=>({FACILITADOR:Number(e?.FACILITADOR??0)||0,ANALISTA:Number(e?.ANALISTA??0)||0,REALIZADOR:Number(e?.REALIZADOR??0)||0,VISIONÁRIO:Number(e?.VISIONÁRIO??0)||0}),_=async e=>{const n=e.trim(),{data:t,error:r}=await s.from("archetype_public_links").select("clinic_id, audience_type, is_active").eq("token",n).eq("is_active",!0).maybeSingle();return r||!t?null:t},d=async e=>{const{answers:n,...t}=e,r=n.map(c=>({question_id:c.questionId,selected_word:c.selectedWord,scored_profile:c.scoredProfile})),{data:o,error:i}=await s.rpc("submit_archetype_response",{p_public_token:t.public_token,p_clinic_id:t.clinic_id,p_audience_type:t.audience_type,p_name:t.name,p_email:t.email??null,p_phone:t.phone??null,p_profession:t.profession??null,p_city:t.city??null,p_consent_lgpd:t.consent_lgpd,p_scores:t.scores,p_top_profile:t.top_profile,p_top_profiles:t.top_profiles??null,p_answers:r});if(i||!o)throw i||new Error("Erro ao salvar respondente.");return o},u=async e=>{let n=a.from("archetype_respondents").select("*").eq("clinic_id",e.clinicId).order("created_at",{ascending:!1});if(e.dateFrom&&(n=n.gte("created_at",`${e.dateFrom}T00:00:00`)),e.dateTo&&(n=n.lte("created_at",`${e.dateTo}T23:59:59`)),e.topProfile&&(n=n.eq("top_profile",e.topProfile)),e.audienceType&&(n=n.eq("audience_type",e.audienceType)),e.token&&(n=n.eq("public_token",e.token)),e.search){const o=`%${e.search}%`;n=n.or(`name.ilike.${o},email.ilike.${o}`)}const{data:t,error:r}=await n;if(r)throw r;return(t||[]).map(o=>({...o,scores:p(o.scores)}))},m=async(e,n)=>{const{data:t,error:r}=await a.from("archetype_respondents").select("*, archetype_answers (question_id, selected_word, scored_profile)").eq("clinic_id",n).eq("id",e).single();if(r)throw r;return t?{...t,scores:p(t.scores)}:null},f=async e=>{const{data:n,error:t}=await a.from("archetype_public_links").select("*").eq("clinic_id",e).order("created_at",{ascending:!1});if(t)throw t;return n||[]},y=async e=>{const{data:n,error:t}=await a.from("archetype_public_links").insert([e]).select("*").single();if(t)throw t;return n},b=async(e,n)=>{const{data:t,error:r}=await a.from("archetype_public_links").update({is_active:n}).eq("id",e).select("*").single();if(r)throw r;return t};export{m as a,y as c,u as f,f as l,_ as r,d as s,b as t};
