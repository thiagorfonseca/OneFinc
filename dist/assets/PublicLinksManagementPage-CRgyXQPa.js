import{c as L,u as E,r as s,j as e}from"./index-D0iWI1-0.js";import{l as T,c as A,t as I}from"./archetypeService-mUGP5OAI.js";import{P as S}from"./plus-XBhS4Bhv.js";const _=L("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),j=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID().replace(/-/g,"").slice(0,12):Math.random().toString(36).slice(2,12),U=()=>{const{effectiveClinicId:r,user:b}=E(),[d,i]=s.useState([]),[o,x]=s.useState(!0),[p,u]=s.useState(!1),[l,y]=s.useState(j()),[m,N]=s.useState("EXTERNAL"),[h,n]=s.useState(null),c=s.useMemo(()=>typeof window>"u"?"":window.location.origin.replace(/\/$/,""),[]),g=s.useCallback(async()=>{if(r){x(!0),n(null);try{const t=await T(r);i(t)}catch(t){console.error(t),n("Não foi possível carregar os links.")}finally{x(!1)}}},[r]);s.useEffect(()=>{g()},[g]);const v=async()=>{if(r){if(!l.trim()){n("Informe um token válido.");return}u(!0),n(null);try{const t=await A({clinic_id:r,token:l.trim(),audience_type:m,created_by_user_id:b?.id||null});i(a=>[t,...a]),y(j())}catch(t){console.error(t),n("Não foi possível criar o link. Verifique se o token já existe.")}finally{u(!1)}}},k=async t=>{const a=`${c}/public/perfil/${t}`;try{await navigator.clipboard.writeText(a)}catch{}},w=async t=>{try{const a=await I(t.id,!t.is_active);i(C=>C.map(f=>f.id===t.id?a:f))}catch(a){console.error(a),n("Não foi possível atualizar o link.")}};return r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Links de Perfil"}),e.jsx("p",{className:"text-gray-500",children:"Crie e gerencie links públicos do teste comportamental."})]}),h&&e.jsx("p",{className:"text-sm text-red-500",children:h}),e.jsxs("div",{className:"bg-white border border-gray-100 rounded-2xl p-4 grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs text-gray-500",children:"Token público"}),e.jsx("input",{value:l,onChange:t=>y(t.target.value),className:"mt-1 w-full px-3 py-2 border border-gray-200 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500",children:"Audiência"}),e.jsxs("select",{value:m,onChange:t=>N(t.target.value),className:"mt-1 w-full px-3 py-2 border border-gray-200 rounded-lg bg-white",children:[e.jsx("option",{value:"INTERNAL",children:"Interna"}),e.jsx("option",{value:"EXTERNAL",children:"Externa"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{type:"button",onClick:v,disabled:p,className:"w-full inline-flex items-center justify-center gap-2 px-4 py-2 rounded-lg bg-brand-600 text-white font-medium disabled:opacity-50",children:[e.jsx(S,{size:16}),p?"Criando...":"Criar link"]})})]}),e.jsx("div",{className:"bg-white border border-gray-100 rounded-2xl overflow-hidden",children:e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3",children:"Token"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Audiência"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Status"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Link"}),e.jsx("th",{className:"text-left px-4 py-3",children:"Ações"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[d.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 font-medium text-gray-800",children:t.token}),e.jsx("td",{className:"px-4 py-3",children:t.audience_type==="INTERNAL"?"Interna":"Externa"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${t.is_active?"bg-emerald-100 text-emerald-700":"bg-gray-100 text-gray-500"}`,children:t.is_active?"Ativo":"Inativo"})}),e.jsx("td",{className:"px-4 py-3 text-xs text-gray-500",children:c?`${c}/public/perfil/${t.token}`:"Link indisponível"}),e.jsxs("td",{className:"px-4 py-3 flex items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>k(t.token),className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-lg border border-gray-200 text-xs text-gray-600",children:[e.jsx(_,{size:14}),"Copiar"]}),e.jsx("button",{type:"button",onClick:()=>w(t),className:"inline-flex items-center gap-1 px-3 py-1.5 rounded-lg border border-gray-200 text-xs text-gray-600",children:t.is_active?"Desativar":"Ativar"})]})]},t.id)),!o&&d.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"px-4 py-6 text-center text-gray-400",colSpan:5,children:"Nenhum link criado."})}),o&&e.jsx("tr",{children:e.jsx("td",{className:"px-4 py-6 text-center text-gray-400",colSpan:5,children:"Carregando links..."})})]})]})})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Links de Perfil"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Selecione uma clínica para gerenciar os links."})]})};export{U as default};
